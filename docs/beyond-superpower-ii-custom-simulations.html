<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 15 Beyond Superpower II: Custom Simulations | Power Analysis with Superpower</title>
  <meta name="description" content="This is a book describing the capabilities of the Superpower R package." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 15 Beyond Superpower II: Custom Simulations | Power Analysis with Superpower" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book describing the capabilities of the Superpower R package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 15 Beyond Superpower II: Custom Simulations | Power Analysis with Superpower" />
  
  <meta name="twitter:description" content="This is a book describing the capabilities of the Superpower R package." />
  

<meta name="author" content="Aaron R. Caldwell, Daniël Lakens, Chelsea M. Parlett-Pelleriti, and Guy Prochilo" />


<meta name="date" content="2021-12-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="beyond-superpower-i-mixed-models-with-simr.html"/>
<link rel="next" href="appendix-1-direct-comparison-to-pwr2ppl.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#funding"><i class="fa fa-check"></i>Funding</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html"><i class="fa fa-check"></i><b>1</b> Introduction to Power Analysis</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#overview-of-power-analysis"><i class="fa fa-check"></i><b>1.1</b> Overview of Power Analysis</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#error-and-power"><i class="fa fa-check"></i><b>1.2</b> Error and Power</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#effect-size"><i class="fa fa-check"></i><b>1.3</b> Effect size</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#samp_vs_pop"><i class="fa fa-check"></i><b>1.4</b> Sample effect size vs. population effect size</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#safeguard-effect-size"><i class="fa fa-check"></i><b>1.5</b> Safeguard Effect Size</a></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#post-hoc-power-analysis"><i class="fa fa-check"></i><b>1.6</b> <em>Post hoc</em> power analysis</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#the-sample-effect-size-is-not-the-population-effect-size"><i class="fa fa-check"></i><b>1.6.1</b> The sample effect size is <em>not</em> the population effect size</a></li>
<li class="chapter" data-level="1.6.2" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#post-hoc-power-is-merely-a-transformation-of-your-obtained-p-value"><i class="fa fa-check"></i><b>1.6.2</b> <em>Post hoc</em> power is merely a transformation of your obtained <em>p</em> value</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#the-minimal-detectable-effect-size"><i class="fa fa-check"></i><b>1.7</b> The Minimal Detectable Effect Size</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-experimental-design.html"><a href="the-experimental-design.html"><i class="fa fa-check"></i><b>2</b> The Experimental Design</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-experimental-design.html"><a href="the-experimental-design.html#anova_design-function"><i class="fa fa-check"></i><b>2.1</b> ANOVA_design function</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-design-using-design"><i class="fa fa-check"></i><b>2.1.1</b> Specifying the design using <code>design</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-means-using-mu"><i class="fa fa-check"></i><b>2.1.2</b> Specifying the means using <code>mu</code></a></li>
<li class="chapter" data-level="2.1.3" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-label-names"><i class="fa fa-check"></i><b>2.1.3</b> Specifying label names</a></li>
<li class="chapter" data-level="2.1.4" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-correlation"><i class="fa fa-check"></i><b>2.1.4</b> Specifying the correlation</a></li>
<li class="chapter" data-level="2.1.5" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-sample-size"><i class="fa fa-check"></i><b>2.1.5</b> Specifying the sample size</a></li>
<li class="chapter" data-level="2.1.6" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-standard-deviation"><i class="fa fa-check"></i><b>2.1.6</b> Specifying the standard deviation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="one-way-anova.html"><a href="one-way-anova.html"><i class="fa fa-check"></i><b>3</b> One-Way ANOVA</a>
<ul>
<li class="chapter" data-level="3.1" data-path="one-way-anova.html"><a href="one-way-anova.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="one-way-anova.html"><a href="one-way-anova.html#two-conditions"><i class="fa fa-check"></i><b>3.1.1</b> Two conditions</a></li>
<li class="chapter" data-level="3.1.2" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions"><i class="fa fa-check"></i><b>3.1.2</b> Three conditions</a></li>
<li class="chapter" data-level="3.1.3" data-path="one-way-anova.html"><a href="one-way-anova.html#power-for-simple-effects"><i class="fa fa-check"></i><b>3.1.3</b> Power for simple effects</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="one-way-anova.html"><a href="one-way-anova.html#effect-size-estimates-for-one-way-anova"><i class="fa fa-check"></i><b>3.2</b> Effect Size Estimates for One-Way ANOVA</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions-small-effect-size"><i class="fa fa-check"></i><b>3.2.1</b> Three conditions, small effect size</a></li>
<li class="chapter" data-level="3.2.2" data-path="one-way-anova.html"><a href="one-way-anova.html#four-conditions-medium-effect-size"><i class="fa fa-check"></i><b>3.2.2</b> Four conditions, medium effect size</a></li>
<li class="chapter" data-level="3.2.3" data-path="one-way-anova.html"><a href="one-way-anova.html#two-conditions-large-effect-size"><i class="fa fa-check"></i><b>3.2.3</b> Two conditions, large effect size</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html"><i class="fa fa-check"></i><b>4</b> Repeated Measures ANOVA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-1"><i class="fa fa-check"></i><b>4.1</b> Part 1</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#two-conditions-medium-effect-size"><i class="fa fa-check"></i><b>4.1.1</b> Two conditions, medium effect size</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-2"><i class="fa fa-check"></i><b>4.2</b> Part 2</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#the-relation-between-cohens-f-and-cohens-d"><i class="fa fa-check"></i><b>4.2.1</b> The relation between Cohen’s f and Cohen’s d</a></li>
<li class="chapter" data-level="4.2.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#three-within-conditions-medium-effect-size"><i class="fa fa-check"></i><b>4.2.2</b> Three within conditions, medium effect size</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-3"><i class="fa fa-check"></i><b>4.3</b> Part 3</a></li>
<li class="chapter" data-level="4.4" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-4"><i class="fa fa-check"></i><b>4.4</b> Part 4</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#x2-anova-within-within-design"><i class="fa fa-check"></i><b>4.4.1</b> 2x2 ANOVA, within-within design</a></li>
<li class="chapter" data-level="4.4.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#examine-variation-of-means-and-correlation"><i class="fa fa-check"></i><b>4.4.2</b> Examine variation of means and correlation</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-5"><i class="fa fa-check"></i><b>4.5</b> Part 5</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#x2-anova-within-design"><i class="fa fa-check"></i><b>4.5.1</b> 2x2 ANOVA, within design</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#multivariate-anova-manova"><i class="fa fa-check"></i><b>4.6</b> Multivariate ANOVA (MANOVA)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mixed-anova.html"><a href="mixed-anova.html"><i class="fa fa-check"></i><b>5</b> Mixed ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mixed-anova.html"><a href="mixed-anova.html#simple-mixed-designs"><i class="fa fa-check"></i><b>5.1</b> Simple Mixed Designs</a></li>
<li class="chapter" data-level="5.2" data-path="mixed-anova.html"><a href="mixed-anova.html#complex-mixed-designs"><i class="fa fa-check"></i><b>5.2</b> Complex Mixed Designs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mixed-anova.html"><a href="mixed-anova.html#b3w-design"><i class="fa fa-check"></i><b>5.2.1</b> 2b*3w Design</a></li>
<li class="chapter" data-level="5.2.2" data-path="mixed-anova.html"><a href="mixed-anova.html#b4w-design"><i class="fa fa-check"></i><b>5.2.2</b> 2b*4w Design</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="power-for-three-way-interactions.html"><a href="power-for-three-way-interactions.html"><i class="fa fa-check"></i><b>6</b> Power for Three-way Interactions</a></li>
<li class="chapter" data-level="7" data-path="the-no-way-interactions.html"><a href="the-no-way-interactions.html"><i class="fa fa-check"></i><b>7</b> The ‘No-Way’ Interactions</a></li>
<li class="chapter" data-level="8" data-path="effect-of-varying-designs-on-power.html"><a href="effect-of-varying-designs-on-power.html"><i class="fa fa-check"></i><b>8</b> Effect of Varying Designs on Power</a>
<ul>
<li class="chapter" data-level="8.1" data-path="effect-of-varying-designs-on-power.html"><a href="effect-of-varying-designs-on-power.html#within-designs"><i class="fa fa-check"></i><b>8.1</b> Within Designs</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="error-control-in-exploratory-anova.html"><a href="error-control-in-exploratory-anova.html"><i class="fa fa-check"></i><b>9</b> Error Control in Exploratory ANOVA</a></li>
<li class="chapter" data-level="10" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html"><i class="fa fa-check"></i><b>10</b> Analytic Power Functions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#one-way-between-subjects-anova"><i class="fa fa-check"></i><b>10.1</b> One-Way Between Subjects ANOVA</a></li>
<li class="chapter" data-level="10.2" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#two-way-between-subject-interaction"><i class="fa fa-check"></i><b>10.2</b> Two-way Between Subject Interaction</a></li>
<li class="chapter" data-level="10.3" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#x3-between-subject-anova"><i class="fa fa-check"></i><b>10.3</b> 3x3 Between Subject ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="power-curve.html"><a href="power-curve.html"><i class="fa fa-check"></i><b>11</b> Power Curve</a>
<ul>
<li class="chapter" data-level="11.1" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-effect-size-for-moderated-interactions."><i class="fa fa-check"></i><b>11.1</b> Explore increase in effect size for moderated interactions.</a></li>
<li class="chapter" data-level="11.2" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-effect-size-for-cross-over-interactions."><i class="fa fa-check"></i><b>11.2</b> Explore increase in effect size for cross-over interactions.</a></li>
<li class="chapter" data-level="11.3" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-correlation-in-moderated-interactions."><i class="fa fa-check"></i><b>11.3</b> Explore increase in correlation in moderated interactions.</a></li>
<li class="chapter" data-level="11.4" data-path="power-curve.html"><a href="power-curve.html#increasing-correlation-in-on-factor-decreases-power-in-second-factor"><i class="fa fa-check"></i><b>11.4</b> Increasing correlation in on factor decreases power in second factor</a></li>
<li class="chapter" data-level="11.5" data-path="power-curve.html"><a href="power-curve.html#code-to-reproduce-power-curve-figures"><i class="fa fa-check"></i><b>11.5</b> Code to Reproduce Power Curve Figures</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html"><i class="fa fa-check"></i><b>12</b> Violations of Assumptions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html#violation-of-heterogeneity-assumption"><i class="fa fa-check"></i><b>12.1</b> Violation of Heterogeneity Assumption</a></li>
<li class="chapter" data-level="12.2" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html#violation-of-the-sphericity-assumption"><i class="fa fa-check"></i><b>12.2</b> Violation of the sphericity assumption</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html#manova-or-sphericity-adjustment"><i class="fa fa-check"></i><b>12.2.1</b> MANOVA or Sphericity Adjustment?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html"><i class="fa fa-check"></i><b>13</b> Estimated Marginal Means</a>
<ul>
<li class="chapter" data-level="13.1" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#a-note-of-caution"><i class="fa fa-check"></i><b>13.1</b> A note of caution</a></li>
<li class="chapter" data-level="13.2" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#pairwise-comparisons"><i class="fa fa-check"></i><b>13.2</b> Pairwise Comparisons</a></li>
<li class="chapter" data-level="13.3" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#customized-emmeans-contrasts"><i class="fa fa-check"></i><b>13.3</b> Customized <code>emmeans</code> contrasts</a></li>
<li class="chapter" data-level="13.4" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#equivalence-and-non-superiority-inferiority-tests"><i class="fa fa-check"></i><b>13.4</b> Equivalence and non-superiority/-inferiority tests</a></li>
<li class="chapter" data-level="13.5" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#joint-tests"><i class="fa fa-check"></i><b>13.5</b> Joint tests</a></li>
<li class="chapter" data-level="13.6" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#monte-carlo-simulations"><i class="fa fa-check"></i><b>13.6</b> Monte Carlo Simulations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="beyond-superpower-i-mixed-models-with-simr.html"><a href="beyond-superpower-i-mixed-models-with-simr.html"><i class="fa fa-check"></i><b>14</b> Beyond Superpower I: Mixed Models with <code>simr</code></a>
<ul>
<li class="chapter" data-level="14.1" data-path="beyond-superpower-i-mixed-models-with-simr.html"><a href="beyond-superpower-i-mixed-models-with-simr.html#how-does-simr-work"><i class="fa fa-check"></i><b>14.1</b> How does <code>simr</code> work?</a></li>
<li class="chapter" data-level="14.2" data-path="beyond-superpower-i-mixed-models-with-simr.html"><a href="beyond-superpower-i-mixed-models-with-simr.html#to-be-continued"><i class="fa fa-check"></i><b>14.2</b> To Be Continued…</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html"><i class="fa fa-check"></i><b>15</b> Beyond Superpower II: Custom Simulations</a>
<ul>
<li class="chapter" data-level="15.1" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#a-clincal-trial-with-a-binary-outcome"><i class="fa fa-check"></i><b>15.1</b> A Clincal Trial with a Binary Outcome</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#proposed-study-and-approach"><i class="fa fa-check"></i><b>15.1.1</b> Proposed Study and Approach</a></li>
<li class="chapter" data-level="15.1.2" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#step-1-create-a-data-generating-function"><i class="fa fa-check"></i><b>15.1.2</b> Step 1: Create a Data Generating Function</a></li>
<li class="chapter" data-level="15.1.3" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#step-2-simulation"><i class="fa fa-check"></i><b>15.1.3</b> Step 2: Simulation</a></li>
<li class="chapter" data-level="15.1.4" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#why-more-complicated-code"><i class="fa fa-check"></i><b>15.1.4</b> Why more complicated code?</a></li>
<li class="chapter" data-level="15.1.5" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#conclusions-on-the-binary-rct-analysis"><i class="fa fa-check"></i><b>15.1.5</b> Conclusions on the Binary RCT Analysis</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#binary-rct-with-a-interim-analysis"><i class="fa fa-check"></i><b>15.2</b> Binary RCT with a Interim Analysis</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#proposed-study-and-approach-1"><i class="fa fa-check"></i><b>15.2.1</b> Proposed Study and Approach</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#conclusion-on-a-binary-rct-with-interim-analyses"><i class="fa fa-check"></i><b>15.3</b> Conclusion on a Binary RCT with Interim Analyses</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html"><i class="fa fa-check"></i>Appendix 1: Direct Comparison to pwr2ppl</a>
<ul>
<li class="chapter" data-level="15.4" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#examples-from-chapter-5"><i class="fa fa-check"></i><b>15.4</b> Examples from Chapter 5</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-5.15.2"><i class="fa fa-check"></i><b>15.4.1</b> Example 5.1/5.2</a></li>
<li class="chapter" data-level="15.4.2" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-5.3"><i class="fa fa-check"></i><b>15.4.2</b> Example 5.3</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#examples-from-chapter-6"><i class="fa fa-check"></i><b>15.5</b> Examples from Chapter 6</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.2"><i class="fa fa-check"></i><b>15.5.1</b> Example from Table 6.2</a></li>
<li class="chapter" data-level="15.5.2" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.6"><i class="fa fa-check"></i><b>15.5.2</b> Example from Table 6.6</a></li>
<li class="chapter" data-level="15.5.3" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.8"><i class="fa fa-check"></i><b>15.5.3</b> Example from Table 6.8</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-chapter-7"><i class="fa fa-check"></i><b>15.6</b> Example from Chapter 7</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#from-table-7.2"><i class="fa fa-check"></i><b>15.6.1</b> From Table 7.2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-2-direct-comparison-to-morepower.html"><a href="appendix-2-direct-comparison-to-morepower.html"><i class="fa fa-check"></i>Appendix 2: Direct Comparison to MOREpower</a></li>
<li class="chapter" data-level="" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html"><i class="fa fa-check"></i>Appendix 3: Comparison to Brysbaert</a>
<ul>
<li class="chapter" data-level="15.7" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#one-way-anova-1"><i class="fa fa-check"></i><b>15.7</b> One-Way ANOVA</a>
<ul>
<li class="chapter" data-level="15.7.1" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#three-conditions-replication"><i class="fa fa-check"></i><b>15.7.1</b> Three conditions replication</a></li>
<li class="chapter" data-level="15.7.2" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#variation-1"><i class="fa fa-check"></i><b>15.7.2</b> Variation 1</a></li>
<li class="chapter" data-level="15.7.3" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#three-conditions-replication-1"><i class="fa fa-check"></i><b>15.7.3</b> Three conditions replication</a></li>
<li class="chapter" data-level="15.7.4" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#variation-2"><i class="fa fa-check"></i><b>15.7.4</b> Variation 2</a></li>
<li class="chapter" data-level="15.7.5" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#three-conditions-replication-2"><i class="fa fa-check"></i><b>15.7.5</b> Three conditions replication</a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#repeated-measures"><i class="fa fa-check"></i><b>15.8</b> Repeated Measures</a>
<ul>
<li class="chapter" data-level="15.8.1" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#reproducing-brysbaert-variation-1-changing-correlation"><i class="fa fa-check"></i><b>15.8.1</b> Reproducing Brysbaert Variation 1: Changing Correlation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Power Analysis with Superpower</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="beyond-superpower-ii-custom-simulations" class="section level1" number="15">
<h1><span class="header-section-number">Chapter 15</span> Beyond Superpower II: Custom Simulations</h1>
<p>Sometimes it may be better just to simulate your planned study. If your study has peculiar features that current software does not support custom simulation may be your only possible solution. This approach is flexible and you can customize it as much as you are willing to code. The downside is that the process will be more time consuming and it is possible to introduce errors in your code.</p>
<p>In this chapter, we will provide a few vignettes on how to implement simulation-based power analyses for a variety of outcomes and designs. Overall, all you need for these simulations is an accurate data generating process and the ability to repeat that process many times (preferably a few thousand iterations). This is the same process that <code>Superpower</code> performs under-the-hood when you are running simulations with <code>ANOVA_power</code>. The ability to write your own simulations and data generating mechanisms is a powerful tool that allows you to test your analyses, and assumptions about those analyses, prior to any data being collected.</p>
<div id="a-clincal-trial-with-a-binary-outcome" class="section level2" number="15.1">
<h2><span class="header-section-number">15.1</span> A Clincal Trial with a Binary Outcome</h2>
<p>This section was inspired by a Twitter <a href="https://twitter.com/ADAlthousePhD/status/1353819045829742593?s=20">thread</a> from Andrew Althouse, a PhD statistician currently at the University of Pittsburgh Medical School, on creating a simulation of Randomized Clinical/Control Trial (RCT) data. We wanted to expand on his suggestions and provide some of my own recommendations. In Andrew’s thread he explicitly used base R and only default <code>stats</code> functions that are native to R. While these are great tools, they are limited and most researchers wanting to simulate a study will find these tools lacking when trying to simulate their own particular study. This is <em>not</em> a criticism of Dr. Althouse’s thread, it is a wonderful thread. However, in this section we will use a mostly “tidy” approach for generating the data.</p>
<p>In this section we will use <code>simstudy</code> as a way to pseudo-replicate the results from Dr. Althouse. This will serve as a simple introduce to simulating experimental designs and how this can be utilized for power analysis purposes. All the code here will be “functional” which means we will define new functions that will generate the data. This way you can run multiple variations on your simulation with only a few more lines of code (rather than copy and pasting the whole simulation again and again).</p>
<p><strong>R Packages</strong></p>
<p>For this simulation I will try to restrict my use of packages to as few as possible. To simulate the data again I will need the <code>simstudy</code> package and I will also <code>tidyverse</code> set of packages to make the code “tidy.” In addition, I will need the</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="beyond-superpower-ii-custom-simulations.html#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simstudy)</span>
<span id="cb671-2"><a href="beyond-superpower-ii-custom-simulations.html#cb671-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb671-3"><a href="beyond-superpower-ii-custom-simulations.html#cb671-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<div id="proposed-study-and-approach" class="section level3" number="15.1.1">
<h3><span class="header-section-number">15.1.1</span> Proposed Study and Approach</h3>
<p>According to Dr. Althouse’s documentation he was trying to simulate the following study:</p>
<ul>
<li>This code will mimic a 2-group parallel-arm randomized trial using 1:1 allocation of patients to treatment 1 versus treatment 2</li>
<li>For this example, we will use a binary outcome of “death”</li>
<li>Patients receiving treatment 1 will have a 40% probability of death</li>
<li>Patients receiving treatment 2 will have a 30% probability of death</li>
<li>Analysis will be performed using a logistic regression model</li>
<li>We will run 100 simulated RCT’s and report the odds ratio, 95% confidence interval, and p-value for each simulated trial</li>
<li>The “true” treatment effect for a treatment that reduces probability of outcome from 40% to 30% is about OR = 0.642</li>
<li>The power of a trial with N=1000 patients and exactly 1:1 allocation under these assumptions is about 91-92%</li>
</ul>
<p>Some people reading this may already feel a tad overwhelmed. But trust me, everyone has to start somewhere and all the authors of this book were in your shoes not too long ago! Also, this is a fairly straightforward process. The process is only made easier when you use the many tools available in R. We are going to create “functions” which essentially means if I want to run the same simulation again (but maybe change 1 or 2 parameters) this can be done with only a few lines of code. This is efficient and if you are serious about writing your own simulations I would highly recommend writing your own functions for the simulation.</p>
</div>
<div id="step-1-create-a-data-generating-function" class="section level3" number="15.1.2">
<h3><span class="header-section-number">15.1.2</span> Step 1: Create a Data Generating Function</h3>
<p>This is part looks more complex than it is. All we are doing is making a function that I will call <code>gen_bidat</code> (short for “generate binomial data”). One of the things Althouse mentions in his code is that his allocation in the simulation is inappropriate. We can get around that by incorporating the functions from <code>simstudy</code> (which randomly assigns group) and keeps things organized through the <code>%&gt;%</code> (known as a “pipe”) function. We also will import the <code>data.table</code> package because the <code>simstudy</code> package generates data in a <code>data.table</code> format.</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="beyond-superpower-ii-custom-simulations.html#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function</span></span>
<span id="cb672-2"><a href="beyond-superpower-ii-custom-simulations.html#cb672-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb672-3"><a href="beyond-superpower-ii-custom-simulations.html#cb672-3" aria-hidden="true" tabindex="-1"></a><span class="do">## N = sample size</span></span>
<span id="cb672-4"><a href="beyond-superpower-ii-custom-simulations.html#cb672-4" aria-hidden="true" tabindex="-1"></a><span class="do">## props = proportions in each group (length is equal to number of groups)</span></span>
<span id="cb672-5"><a href="beyond-superpower-ii-custom-simulations.html#cb672-5" aria-hidden="true" tabindex="-1"></a>gen_bidat <span class="ot">=</span> <span class="cf">function</span>(props,N){</span>
<span id="cb672-6"><a href="beyond-superpower-ii-custom-simulations.html#cb672-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data with N participants and balanced assignment to treatment group</span></span>
<span id="cb672-7"><a href="beyond-superpower-ii-custom-simulations.html#cb672-7" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">genData</span>(N) <span class="sc">%&gt;%</span> <span class="co"># generate data with N participants</span></span>
<span id="cb672-8"><a href="beyond-superpower-ii-custom-simulations.html#cb672-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">trtAssign</span>(<span class="at">n =</span> <span class="fu">length</span>(props),</span>
<span id="cb672-9"><a href="beyond-superpower-ii-custom-simulations.html#cb672-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">balanced =</span> <span class="cn">TRUE</span>,</span>
<span id="cb672-10"><a href="beyond-superpower-ii-custom-simulations.html#cb672-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">grpName =</span> <span class="st">&quot;trt&quot;</span>) <span class="co"># Randomly assign treatment (tr) in a balanced fashion  </span></span>
<span id="cb672-11"><a href="beyond-superpower-ii-custom-simulations.html#cb672-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the number of gropus by the number or proportions entered</span></span>
<span id="cb672-12"><a href="beyond-superpower-ii-custom-simulations.html#cb672-12" aria-hidden="true" tabindex="-1"></a>  grps <span class="ot">=</span> <span class="fu">length</span>(props)</span>
<span id="cb672-13"><a href="beyond-superpower-ii-custom-simulations.html#cb672-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate condition for each group</span></span>
<span id="cb672-14"><a href="beyond-superpower-ii-custom-simulations.html#cb672-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This creates a conditional output </span></span>
<span id="cb672-15"><a href="beyond-superpower-ii-custom-simulations.html#cb672-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I.e., the odds of the outcome is determined by treatment group</span></span>
<span id="cb672-16"><a href="beyond-superpower-ii-custom-simulations.html#cb672-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>grps){ <span class="co"># run loop once for each group in the study</span></span>
<span id="cb672-17"><a href="beyond-superpower-ii-custom-simulations.html#cb672-17" aria-hidden="true" tabindex="-1"></a>    grp <span class="ot">=</span> i<span class="dv">-1</span> <span class="co"># the simulation runs from 1 to the total number of groups</span></span>
<span id="cb672-18"><a href="beyond-superpower-ii-custom-simulations.html#cb672-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the i-1 starts the loop at zero</span></span>
<span id="cb672-19"><a href="beyond-superpower-ii-custom-simulations.html#cb672-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We then assign the group (grp) by which number in the loop we are in</span></span>
<span id="cb672-20"><a href="beyond-superpower-ii-custom-simulations.html#cb672-20" aria-hidden="true" tabindex="-1"></a>    con_run <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;trt == &quot;</span>, grp)</span>
<span id="cb672-21"><a href="beyond-superpower-ii-custom-simulations.html#cb672-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We then grab the assign the correct proportion to the groups in order</span></span>
<span id="cb672-22"><a href="beyond-superpower-ii-custom-simulations.html#cb672-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We have to create the object dc first (i == 1)</span></span>
<span id="cb672-23"><a href="beyond-superpower-ii-custom-simulations.html#cb672-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># All iterations of the loop add to dc rather than creating a new dc</span></span>
<span id="cb672-24"><a href="beyond-superpower-ii-custom-simulations.html#cb672-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb672-25"><a href="beyond-superpower-ii-custom-simulations.html#cb672-25" aria-hidden="true" tabindex="-1"></a>      dc <span class="ot">=</span> <span class="fu">defCondition</span>(</span>
<span id="cb672-26"><a href="beyond-superpower-ii-custom-simulations.html#cb672-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">condition =</span> con_run,</span>
<span id="cb672-27"><a href="beyond-superpower-ii-custom-simulations.html#cb672-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> props[i],</span>
<span id="cb672-28"><a href="beyond-superpower-ii-custom-simulations.html#cb672-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist =</span> <span class="st">&quot;binary&quot;</span>,</span>
<span id="cb672-29"><a href="beyond-superpower-ii-custom-simulations.html#cb672-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">link =</span> <span class="st">&quot;identity&quot;</span></span>
<span id="cb672-30"><a href="beyond-superpower-ii-custom-simulations.html#cb672-30" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb672-31"><a href="beyond-superpower-ii-custom-simulations.html#cb672-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb672-32"><a href="beyond-superpower-ii-custom-simulations.html#cb672-32" aria-hidden="true" tabindex="-1"></a>      dc <span class="ot">=</span> <span class="fu">defCondition</span>(</span>
<span id="cb672-33"><a href="beyond-superpower-ii-custom-simulations.html#cb672-33" aria-hidden="true" tabindex="-1"></a>        dc,</span>
<span id="cb672-34"><a href="beyond-superpower-ii-custom-simulations.html#cb672-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">condition =</span> con_run,</span>
<span id="cb672-35"><a href="beyond-superpower-ii-custom-simulations.html#cb672-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> props[i],</span>
<span id="cb672-36"><a href="beyond-superpower-ii-custom-simulations.html#cb672-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist =</span> <span class="st">&quot;binary&quot;</span>,</span>
<span id="cb672-37"><a href="beyond-superpower-ii-custom-simulations.html#cb672-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">link =</span> <span class="st">&quot;identity&quot;</span></span>
<span id="cb672-38"><a href="beyond-superpower-ii-custom-simulations.html#cb672-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb672-39"><a href="beyond-superpower-ii-custom-simulations.html#cb672-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb672-40"><a href="beyond-superpower-ii-custom-simulations.html#cb672-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb672-41"><a href="beyond-superpower-ii-custom-simulations.html#cb672-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb672-42"><a href="beyond-superpower-ii-custom-simulations.html#cb672-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now we generate the outcome based on the group (condition)</span></span>
<span id="cb672-43"><a href="beyond-superpower-ii-custom-simulations.html#cb672-43" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">addCondition</span>(<span class="at">condDefs =</span> dc,</span>
<span id="cb672-44"><a href="beyond-superpower-ii-custom-simulations.html#cb672-44" aria-hidden="true" tabindex="-1"></a>                      <span class="at">dtOld =</span> df,</span>
<span id="cb672-45"><a href="beyond-superpower-ii-custom-simulations.html#cb672-45" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newvar =</span> <span class="st">&quot;y&quot;</span>)</span>
<span id="cb672-46"><a href="beyond-superpower-ii-custom-simulations.html#cb672-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dat)</span>
<span id="cb672-47"><a href="beyond-superpower-ii-custom-simulations.html#cb672-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb672-48"><a href="beyond-superpower-ii-custom-simulations.html#cb672-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-49"><a href="beyond-superpower-ii-custom-simulations.html#cb672-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Test run</span></span>
<span id="cb672-50"><a href="beyond-superpower-ii-custom-simulations.html#cb672-50" aria-hidden="true" tabindex="-1"></a><span class="fu">gen_bidat</span>(<span class="fu">c</span>(.<span class="dv">2</span>,.<span class="dv">35</span>),<span class="at">N=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     id y trt
##  1:  1 0   0
##  2:  2 0   1
##  3:  3 0   1
##  4:  4 0   0
##  5:  5 1   0
##  6:  6 0   0
##  7:  7 1   1
##  8:  8 0   1
##  9:  9 1   0
## 10: 10 0   1</code></pre>
<p>In some cases the function above is enough. We may just want to generate a data set reflective of study we have designed. We can then “play” with the data set to plan analyses for future study. However, that is not what we are after today and we will move onto the power analysis.</p>
</div>
<div id="step-2-simulation" class="section level3" number="15.1.3">
<h3><span class="header-section-number">15.1.3</span> Step 2: Simulation</h3>
<p>Now we can get to the fun part and run a simulation. All this means is that we run the simulated data (above) for a number of iterations or repetitions (typically for thousands of iterations). We can make it a power analysis by counting the number of positive results (e.g., below the significance threshold).</p>
<p>For the power analysis we created a <code>pwr_bidat</code> function that performs a power analysis with a certain number of repetitions (<code>reps</code> argument). Notice below that we are using the function we just created (<code>gen_bidat</code>) within the <code>pwr_bidat</code> function. That is why the user must supply the same information as the last function (the proportions, <code>props</code>, and the sample size, <code>N</code>). In addition, there are two arguments needed for the power analysis: <code>alpha</code> and <code>conf.level</code>. The <code>alpha</code> argument sets the alpha-level for the analyses (i.e., the significance cutoff). While the <code>conf.level</code> argument sets the confidence level (e.g., 95%) for the confidence intervals for the power analysis. We can calculate confidence intervals for a simulation because we have a number of “successes” over a number of attempts (total number of <code>reps</code>). We can use the <code>prop.test</code> function which provides confidence intervals for proportions. This is helpful when for when we are running a small number of simulations and want an idea of what estimates of power are reasonable.</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="beyond-superpower-ii-custom-simulations.html#cb674-1" aria-hidden="true" tabindex="-1"></a>pwr_bidat <span class="ot">=</span> <span class="cf">function</span>(props,N,</span>
<span id="cb674-2"><a href="beyond-superpower-ii-custom-simulations.html#cb674-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">reps=</span><span class="dv">100</span>,</span>
<span id="cb674-3"><a href="beyond-superpower-ii-custom-simulations.html#cb674-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha=</span>.<span class="dv">05</span>,</span>
<span id="cb674-4"><a href="beyond-superpower-ii-custom-simulations.html#cb674-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">conf.level =</span> .<span class="dv">95</span>){</span>
<span id="cb674-5"><a href="beyond-superpower-ii-custom-simulations.html#cb674-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-6"><a href="beyond-superpower-ii-custom-simulations.html#cb674-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create 1 to reps simulated data sets</span></span>
<span id="cb674-7"><a href="beyond-superpower-ii-custom-simulations.html#cb674-7" aria-hidden="true" tabindex="-1"></a>  sims <span class="ot">=</span> <span class="fu">replicate</span>(<span class="at">n =</span> reps,</span>
<span id="cb674-8"><a href="beyond-superpower-ii-custom-simulations.html#cb674-8" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">gen_bidat</span>(props, <span class="at">N =</span> N),</span>
<span id="cb674-9"><a href="beyond-superpower-ii-custom-simulations.html#cb674-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb674-10"><a href="beyond-superpower-ii-custom-simulations.html#cb674-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run an equivalent number of analyses</span></span>
<span id="cb674-11"><a href="beyond-superpower-ii-custom-simulations.html#cb674-11" aria-hidden="true" tabindex="-1"></a>  sims2 <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map</span>(sims,  <span class="sc">~</span> <span class="fu">glm</span>(y <span class="sc">~</span> trt,</span>
<span id="cb674-12"><a href="beyond-superpower-ii-custom-simulations.html#cb674-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> .x,</span>
<span id="cb674-13"><a href="beyond-superpower-ii-custom-simulations.html#cb674-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)))</span>
<span id="cb674-14"><a href="beyond-superpower-ii-custom-simulations.html#cb674-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the summary coefficients from our models</span></span>
<span id="cb674-15"><a href="beyond-superpower-ii-custom-simulations.html#cb674-15" aria-hidden="true" tabindex="-1"></a>  sims3 <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map</span>(sims2,  <span class="sc">~</span> <span class="fu">summary</span>(.x)<span class="sc">$</span>coefficients)</span>
<span id="cb674-16"><a href="beyond-superpower-ii-custom-simulations.html#cb674-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Put all the results into a data frame (tibble)</span></span>
<span id="cb674-17"><a href="beyond-superpower-ii-custom-simulations.html#cb674-17" aria-hidden="true" tabindex="-1"></a>  sims4 <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map</span>(sims3,</span>
<span id="cb674-18"><a href="beyond-superpower-ii-custom-simulations.html#cb674-18" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">~</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="fu">as.data.frame</span>(.x),</span>
<span id="cb674-19"><a href="beyond-superpower-ii-custom-simulations.html#cb674-19" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">&quot;coef&quot;</span>))</span>
<span id="cb674-20"><a href="beyond-superpower-ii-custom-simulations.html#cb674-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all the data frames into one</span></span>
<span id="cb674-21"><a href="beyond-superpower-ii-custom-simulations.html#cb674-21" aria-hidden="true" tabindex="-1"></a>  simsdf <span class="ot">=</span> <span class="fu">bind_rows</span>(sims4, <span class="at">.id =</span> <span class="st">&quot;nrep&quot;</span>)</span>
<span id="cb674-22"><a href="beyond-superpower-ii-custom-simulations.html#cb674-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarize results by coefficient</span></span>
<span id="cb674-23"><a href="beyond-superpower-ii-custom-simulations.html#cb674-23" aria-hidden="true" tabindex="-1"></a>  simspow <span class="ot">=</span> simsdf <span class="sc">%&gt;%</span></span>
<span id="cb674-24"><a href="beyond-superpower-ii-custom-simulations.html#cb674-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(coef) <span class="sc">%&gt;%</span></span>
<span id="cb674-25"><a href="beyond-superpower-ii-custom-simulations.html#cb674-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the power (number of results with p-value &lt; alpha)</span></span>
<span id="cb674-26"><a href="beyond-superpower-ii-custom-simulations.html#cb674-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb674-27"><a href="beyond-superpower-ii-custom-simulations.html#cb674-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> <span class="fu">mean</span>(Estimate),</span>
<span id="cb674-28"><a href="beyond-superpower-ii-custom-simulations.html#cb674-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">power =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Pr(&gt;|z|)</span><span class="st">`</span> <span class="sc">&lt;</span> alpha),</span>
<span id="cb674-29"><a href="beyond-superpower-ii-custom-simulations.html#cb674-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate confidence intervals</span></span>
<span id="cb674-30"><a href="beyond-superpower-ii-custom-simulations.html#cb674-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">power.lci =</span> <span class="fu">prop.test</span>(<span class="fu">sum</span>(<span class="st">`</span><span class="at">Pr(&gt;|z|)</span><span class="st">`</span> <span class="sc">&lt;</span> alpha), reps)<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb674-31"><a href="beyond-superpower-ii-custom-simulations.html#cb674-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">power.uci =</span> <span class="fu">prop.test</span>(<span class="fu">sum</span>(<span class="st">`</span><span class="at">Pr(&gt;|z|)</span><span class="st">`</span> <span class="sc">&lt;</span> alpha), reps)<span class="sc">$</span>conf.int[<span class="dv">2</span>],</span>
<span id="cb674-32"><a href="beyond-superpower-ii-custom-simulations.html#cb674-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span></span>
<span id="cb674-33"><a href="beyond-superpower-ii-custom-simulations.html#cb674-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb674-34"><a href="beyond-superpower-ii-custom-simulations.html#cb674-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb674-35"><a href="beyond-superpower-ii-custom-simulations.html#cb674-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return table of results</span></span>
<span id="cb674-36"><a href="beyond-superpower-ii-custom-simulations.html#cb674-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(simspow)</span>
<span id="cb674-37"><a href="beyond-superpower-ii-custom-simulations.html#cb674-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb674-38"><a href="beyond-superpower-ii-custom-simulations.html#cb674-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-39"><a href="beyond-superpower-ii-custom-simulations.html#cb674-39" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">01292020</span>)</span>
<span id="cb674-40"><a href="beyond-superpower-ii-custom-simulations.html#cb674-40" aria-hidden="true" tabindex="-1"></a>pwr_res <span class="ot">=</span> <span class="fu">pwr_bidat</span>(<span class="fu">c</span>(.<span class="dv">4</span>,.<span class="dv">3</span>),<span class="at">N=</span><span class="dv">1000</span>)</span></code></pre></div>
<p>Now that we have the results we can create a table as output using the <code>kable</code> function.</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="beyond-superpower-ii-custom-simulations.html#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pretty table to print results</span></span>
<span id="cb675-2"><a href="beyond-superpower-ii-custom-simulations.html#cb675-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(pwr_res <span class="sc">%&gt;%</span></span>
<span id="cb675-3"><a href="beyond-superpower-ii-custom-simulations.html#cb675-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename</span>(<span class="at">Coefficients =</span> coef,</span>
<span id="cb675-4"><a href="beyond-superpower-ii-custom-simulations.html#cb675-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Average Log Odds</span><span class="st">`</span> <span class="ot">=</span> estimate,</span>
<span id="cb675-5"><a href="beyond-superpower-ii-custom-simulations.html#cb675-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Power =</span> power,</span>
<span id="cb675-6"><a href="beyond-superpower-ii-custom-simulations.html#cb675-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Lower C.I.</span><span class="st">`</span> <span class="ot">=</span> power.lci,</span>
<span id="cb675-7"><a href="beyond-superpower-ii-custom-simulations.html#cb675-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Upper C.I.</span><span class="st">`</span> <span class="ot">=</span> power.uci),</span>
<span id="cb675-8"><a href="beyond-superpower-ii-custom-simulations.html#cb675-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb675-9"><a href="beyond-superpower-ii-custom-simulations.html#cb675-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Result from Power Simulation&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-316">Table 15.1: </span>Result from Power Simulation
</caption>
<thead>
<tr>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Average Log Odds
</th>
<th style="text-align:right;">
Power
</th>
<th style="text-align:right;">
Lower C.I.
</th>
<th style="text-align:right;">
Upper C.I.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-0.43
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
trt
</td>
<td style="text-align:right;">
-0.43
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0.95
</td>
</tr>
</tbody>
</table>
<p>Based on these results we can can conclude that a study of 1000 patients randomly assigned to one of two treatment groups wherein 30% of participants die in treatment group #1 and 40% perish in treatment group #2 will have approximately 95% power [0.82,0.95]. Notice, that compared to Dr. Althouse’s thread, we estimated the power at 95% (thread noted power at ~92.3%). This is to be expected when simulating data and is why a high number of repetitions are needed to get an accurate estimate of power.</p>
</div>
<div id="why-more-complicated-code" class="section level3" number="15.1.4">
<h3><span class="header-section-number">15.1.4</span> Why more complicated code?</h3>
<p>Well, here is why we create functions: it is easier on yourself in the future. Say, we run three separate simulations with minor differences so I go about with the Althouse approach (maybe even copy and paste the code a few times). Later, I notice a flaw in my code, or maybe there is a small change that alters all three simulations. Well, if I take the time to create the customized functions then all I have to do is change the code in one place (where I defined the function) rather than with every chunk of code that includes the simulation code.</p>
<p>Also, it is easier to produce variations on the same design. Let’s imagine we are doing a study on a treatment for an infectious disease that has a hospitalization rate of at least 3.5% people that get infected (so treatment occurs immediately upon diagnosis and only the most severe are hospitalized). The study investigators want to know if 2000 patients are enough to detect if the proposed treatment reduces the hospitalization rate at least by half (1.75%).</p>
<p>All I have to do is use the same function I have created above but change the arguments in the function.</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="beyond-superpower-ii-custom-simulations.html#cb676-1" aria-hidden="true" tabindex="-1"></a>pwr_2 <span class="ot">=</span> <span class="fu">pwr_bidat</span>(<span class="fu">c</span>(.<span class="dv">035</span>,.<span class="dv">0175</span>),<span class="at">N=</span><span class="dv">2000</span>)</span>
<span id="cb676-2"><a href="beyond-superpower-ii-custom-simulations.html#cb676-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-3"><a href="beyond-superpower-ii-custom-simulations.html#cb676-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(pwr_2,</span>
<span id="cb676-4"><a href="beyond-superpower-ii-custom-simulations.html#cb676-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Another Study of Binary Outcomes&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-317">Table 15.2: </span>Another Study of Binary Outcomes
</caption>
<thead>
<tr>
<th style="text-align:left;">
coef
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
power.lci
</th>
<th style="text-align:right;">
power.uci
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-3.3449342
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.9538987
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
trt
</td>
<td style="text-align:right;">
-0.6826144
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
0.5782080
</td>
<td style="text-align:right;">
0.7677615
</td>
</tr>
</tbody>
</table>
<p>Now, we have the new results in only 4 lines of code! Based on those results we would likely advise the investigators that they will need a larger sample size to conclude effectiveness for their proposed treatment.</p>
</div>
<div id="conclusions-on-the-binary-rct-analysis" class="section level3" number="15.1.5">
<h3><span class="header-section-number">15.1.5</span> Conclusions on the Binary RCT Analysis</h3>
<p>In this section we have demonstrated how to create 2 R functions that 1) generate data and 2) generate a simulation based power analysis. Simulation is not necessary for a simple analysis such as this where analytic solutions exist in programs like <code>GPower</code> or <code>Superpower</code>. However, as we will detail in the next sections, simulation becomes <em>very</em> useful when the design becomes complicated (or when we want to violate the assumptions of the models we use).</p>
</div>
</div>
<div id="binary-rct-with-a-interim-analysis" class="section level2" number="15.2">
<h2><span class="header-section-number">15.2</span> Binary RCT with a Interim Analysis</h2>
<p>Now we can move onto a more complicated, but very useful, RCT design that involves analyzing the data at multiple sample sizes. The process of looking at the data early (i.e., before the full sample size is collected) is called a “interim” analysis, but is sometimes called a “sequential” analysis as well <span class="citation">(<a href="#ref-Lakens2014" role="doc-biblioref">Daniël Lakens 2014</a>; <a href="#ref-Lakens2021" role="doc-biblioref">Daniel Lakens, Pahlke, and Wassmer 2021</a>)</span>. Regardless of what the process is called the goal is the same: more efficient study designs. There is an obvious advantage of including interim analyses is the ability to stop a study early. Therefore the sample size is lower and you can save resources. Why don’t we do this for every study? Well, adjusting for the multiple looks at the data can be difficult, and if we do not adjust for the multiple possible stopping points the Type I error rate will be inflated (e.g., an alpha of 0.05 can be inflated to ~0.35 with unlimited looks at the data).</p>
<div id="proposed-study-and-approach-1" class="section level3" number="15.2.1">
<h3><span class="header-section-number">15.2.1</span> Proposed Study and Approach</h3>
<p>The approach mostly remains the same as the previous example but we have to account for a interim analysis.</p>
<ul>
<li>This code will mimic a 2-group parallel-arm randomized trial using 1:1 allocation of patients to treatment 1 versus treatment 2 with a maximum sample size of 1000 patients.</li>
<li>For this example, we will use a binary outcome of “death”</li>
<li>Patients receiving treatment 1 will have a 40% probability of death</li>
<li>Patients receiving treatment 2 will have a 30% probability of death</li>
<li>Analysis will be performed using a logistic regression model</li>
<li>We will run 100 simulated RCT’s and report the odds ratio, 95% confidence interval, and p-value for each simulated trial</li>
<li>The “true” treatment effect for a treatment that reduces probability of outcome from 40% to 30% is about OR = 0.642</li>
<li>There will be a total of 3 analyses at 50%, 75%, and 100% of the sample size.</li>
<li>The alpha level will be adjusted with a O’Brien-Fleming correction (alpha spending function).</li>
</ul>
<p>Now, for this simulation we will need 1 more R package: `rpact`. This is a <em>very</em> useful package if you are interested in sequential analyses.</p>
<p>To properly plan the study we have to define the number of looks at the data (<code>nLooks</code>), when these analyses would be scheduled as proportion of the total sample size (<code>analyses_scheduled</code>), and we can create an empty vector for the what the adjusted alpha should be (<code>efficacy_thresholds</code>).</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="beyond-superpower-ii-custom-simulations.html#cb677-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpact)</span>
<span id="cb677-2"><a href="beyond-superpower-ii-custom-simulations.html#cb677-2" aria-hidden="true" tabindex="-1"></a><span class="co"># here is where you put the maximum number of analyses</span></span>
<span id="cb677-3"><a href="beyond-superpower-ii-custom-simulations.html#cb677-3" aria-hidden="true" tabindex="-1"></a>nLooks <span class="ot">&lt;-</span> <span class="dv">3</span> </span>
<span id="cb677-4"><a href="beyond-superpower-ii-custom-simulations.html#cb677-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is where you list the information fraction (% of total N)</span></span>
<span id="cb677-5"><a href="beyond-superpower-ii-custom-simulations.html#cb677-5" aria-hidden="true" tabindex="-1"></a><span class="do">## (e.g. here 50%, 75% and 100% information)</span></span>
<span id="cb677-6"><a href="beyond-superpower-ii-custom-simulations.html#cb677-6" aria-hidden="true" tabindex="-1"></a>analyses_scheduled <span class="ot">&lt;-</span> (<span class="fu">c</span>(<span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))</span>
<span id="cb677-7"><a href="beyond-superpower-ii-custom-simulations.html#cb677-7" aria-hidden="true" tabindex="-1"></a>efficacy_thresholds <span class="ot">&lt;-</span> <span class="fu">numeric</span>(nLooks)</span></code></pre></div>
<p>Now, we setup the analysis procedure using the <code>getDesignGroupSequential</code> function from <code>rpact</code>. Notice that we set the if the hypothesis test is one or two sided (<code>sided = 2</code> for a two sided hypothesis in this case), and the overall alpha level is set with <code>alpha</code> argument. We then supply when the analyses will take place with the <code>informationRates</code> argument, and the type of correction to the alpha level for each interim analysis is set with <code>typeofDesign</code>. Since we want a O’Brien-Fleming correction we set it to <code>typeOfDesign = "asOF"</code>.</p>
<p>Once the design is created we can extract it with a simple for loop for the number of analyses to extract the alpha level for each interim analysis.</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="beyond-superpower-ii-custom-simulations.html#cb678-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up design in rpact</span></span>
<span id="cb678-2"><a href="beyond-superpower-ii-custom-simulations.html#cb678-2" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">getDesignGroupSequential</span>(<span class="at">sided =</span> <span class="dv">2</span>,</span>
<span id="cb678-3"><a href="beyond-superpower-ii-custom-simulations.html#cb678-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">alpha =</span> <span class="fl">0.05</span>,</span>
<span id="cb678-4"><a href="beyond-superpower-ii-custom-simulations.html#cb678-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">informationRates =</span> analyses_scheduled,</span>
<span id="cb678-5"><a href="beyond-superpower-ii-custom-simulations.html#cb678-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">typeOfDesign =</span> <span class="st">&quot;asOF&quot;</span>)</span>
<span id="cb678-6"><a href="beyond-superpower-ii-custom-simulations.html#cb678-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nLooks){</span>
<span id="cb678-7"><a href="beyond-superpower-ii-custom-simulations.html#cb678-7" aria-hidden="true" tabindex="-1"></a>  efficacy_thresholds[j] <span class="ot">=</span> design<span class="sc">$</span>stageLevels[j]</span>
<span id="cb678-8"><a href="beyond-superpower-ii-custom-simulations.html#cb678-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can create our own function again. We’ll call it <code>pwr_bidat2</code>. Essentially this does the same thing as the function in the last example. However, it takes three looks at the data when there are 500, 750, and 1000 patients. So a for loop will split up the sample and add interim analyses at these points. The loop will stop for each repetition of the simulation when either the observed <em>p</em>-value is less than the corrected alpha or when the total sample size is reached. Those results are then counted and save in the <code>res_tab</code> portion of the function’s output.</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="beyond-superpower-ii-custom-simulations.html#cb679-1" aria-hidden="true" tabindex="-1"></a>pwr_bidat2 <span class="ot">=</span> <span class="cf">function</span>(props, N,</span>
<span id="cb679-2"><a href="beyond-superpower-ii-custom-simulations.html#cb679-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">interim_n =</span> <span class="fu">c</span>(<span class="dv">500</span>,<span class="dv">750</span>,<span class="dv">1000</span>),</span>
<span id="cb679-3"><a href="beyond-superpower-ii-custom-simulations.html#cb679-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">reps =</span> <span class="dv">100</span>,</span>
<span id="cb679-4"><a href="beyond-superpower-ii-custom-simulations.html#cb679-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">alpha =</span> efficacy_thresholds,</span>
<span id="cb679-5"><a href="beyond-superpower-ii-custom-simulations.html#cb679-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">conf.level =</span> .<span class="dv">95</span>){</span>
<span id="cb679-6"><a href="beyond-superpower-ii-custom-simulations.html#cb679-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Create empty data frame for the results of each repetition </span></span>
<span id="cb679-7"><a href="beyond-superpower-ii-custom-simulations.html#cb679-7" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">N =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,reps),</span>
<span id="cb679-8"><a href="beyond-superpower-ii-custom-simulations.html#cb679-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,reps),</span>
<span id="cb679-9"><a href="beyond-superpower-ii-custom-simulations.html#cb679-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">success =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,reps),</span>
<span id="cb679-10"><a href="beyond-superpower-ii-custom-simulations.html#cb679-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stop =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,reps),</span>
<span id="cb679-11"><a href="beyond-superpower-ii-custom-simulations.html#cb679-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">p.value =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,reps),</span>
<span id="cb679-12"><a href="beyond-superpower-ii-custom-simulations.html#cb679-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">estimate =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,reps))</span>
<span id="cb679-13"><a href="beyond-superpower-ii-custom-simulations.html#cb679-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb679-14"><a href="beyond-superpower-ii-custom-simulations.html#cb679-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For loop for each repitition of the  simulation  </span></span>
<span id="cb679-15"><a href="beyond-superpower-ii-custom-simulations.html#cb679-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>reps){</span>
<span id="cb679-16"><a href="beyond-superpower-ii-custom-simulations.html#cb679-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate full data set</span></span>
<span id="cb679-17"><a href="beyond-superpower-ii-custom-simulations.html#cb679-17" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">=</span> <span class="fu">gen_bidat</span>(props, <span class="at">N =</span> N) </span>
<span id="cb679-18"><a href="beyond-superpower-ii-custom-simulations.html#cb679-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set logical indicator for stopping the trial</span></span>
<span id="cb679-19"><a href="beyond-superpower-ii-custom-simulations.html#cb679-19" aria-hidden="true" tabindex="-1"></a>    stop_trial <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb679-20"><a href="beyond-superpower-ii-custom-simulations.html#cb679-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run loop for each potential stopping point</span></span>
<span id="cb679-21"><a href="beyond-superpower-ii-custom-simulations.html#cb679-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(interim_n)){</span>
<span id="cb679-22"><a href="beyond-superpower-ii-custom-simulations.html#cb679-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set current N and alpha level</span></span>
<span id="cb679-23"><a href="beyond-superpower-ii-custom-simulations.html#cb679-23" aria-hidden="true" tabindex="-1"></a>      val <span class="ot">=</span> interim_n[j]</span>
<span id="cb679-24"><a href="beyond-superpower-ii-custom-simulations.html#cb679-24" aria-hidden="true" tabindex="-1"></a>      alpha_j <span class="ot">=</span> alpha[j]</span>
<span id="cb679-25"><a href="beyond-superpower-ii-custom-simulations.html#cb679-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Only continue analysis if stopping criteria not met</span></span>
<span id="cb679-26"><a href="beyond-superpower-ii-custom-simulations.html#cb679-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(stop_trial <span class="sc">!=</span> <span class="cn">TRUE</span>){</span>
<span id="cb679-27"><a href="beyond-superpower-ii-custom-simulations.html#cb679-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get interim data points</span></span>
<span id="cb679-28"><a href="beyond-superpower-ii-custom-simulations.html#cb679-28" aria-hidden="true" tabindex="-1"></a>        dat_i <span class="ot">=</span> dat[<span class="dv">1</span><span class="sc">:</span>val,]</span>
<span id="cb679-29"><a href="beyond-superpower-ii-custom-simulations.html#cb679-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Build model</span></span>
<span id="cb679-30"><a href="beyond-superpower-ii-custom-simulations.html#cb679-30" aria-hidden="true" tabindex="-1"></a>        mod_i <span class="ot">=</span> <span class="fu">glm</span>(y <span class="sc">~</span> trt,</span>
<span id="cb679-31"><a href="beyond-superpower-ii-custom-simulations.html#cb679-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> dat_i,</span>
<span id="cb679-32"><a href="beyond-superpower-ii-custom-simulations.html#cb679-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb679-33"><a href="beyond-superpower-ii-custom-simulations.html#cb679-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get results from the model</span></span>
<span id="cb679-34"><a href="beyond-superpower-ii-custom-simulations.html#cb679-34" aria-hidden="true" tabindex="-1"></a>        sum_i <span class="ot">=</span> <span class="fu">summary</span>(mod_i)<span class="sc">$</span>coefficients[<span class="dv">2</span>,]</span>
<span id="cb679-35"><a href="beyond-superpower-ii-custom-simulations.html#cb679-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb679-36"><a href="beyond-superpower-ii-custom-simulations.html#cb679-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine if the trial can stop</span></span>
<span id="cb679-37"><a href="beyond-superpower-ii-custom-simulations.html#cb679-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(sum_i[<span class="dv">4</span>] <span class="sc">&lt;</span> alpha_j){</span>
<span id="cb679-38"><a href="beyond-superpower-ii-custom-simulations.html#cb679-38" aria-hidden="true" tabindex="-1"></a>          stop_trial <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb679-39"><a href="beyond-superpower-ii-custom-simulations.html#cb679-39" aria-hidden="true" tabindex="-1"></a>          alpha_f <span class="ot">=</span> alpha_j</span>
<span id="cb679-40"><a href="beyond-superpower-ii-custom-simulations.html#cb679-40" aria-hidden="true" tabindex="-1"></a>          n_f <span class="ot">=</span> val</span>
<span id="cb679-41"><a href="beyond-superpower-ii-custom-simulations.html#cb679-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb679-42"><a href="beyond-superpower-ii-custom-simulations.html#cb679-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb679-43"><a href="beyond-superpower-ii-custom-simulations.html#cb679-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb679-44"><a href="beyond-superpower-ii-custom-simulations.html#cb679-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb679-45"><a href="beyond-superpower-ii-custom-simulations.html#cb679-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get final alpha and N if no &quot;success&quot; at final N</span></span>
<span id="cb679-46"><a href="beyond-superpower-ii-custom-simulations.html#cb679-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stop_trial <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb679-47"><a href="beyond-superpower-ii-custom-simulations.html#cb679-47" aria-hidden="true" tabindex="-1"></a>      n_f <span class="ot">=</span> val</span>
<span id="cb679-48"><a href="beyond-superpower-ii-custom-simulations.html#cb679-48" aria-hidden="true" tabindex="-1"></a>      alpha_f <span class="ot">=</span> alpha_j</span>
<span id="cb679-49"><a href="beyond-superpower-ii-custom-simulations.html#cb679-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb679-50"><a href="beyond-superpower-ii-custom-simulations.html#cb679-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results from this repetition</span></span>
<span id="cb679-51"><a href="beyond-superpower-ii-custom-simulations.html#cb679-51" aria-hidden="true" tabindex="-1"></a>    res<span class="sc">$</span>N[i] <span class="ot">=</span> n_f</span>
<span id="cb679-52"><a href="beyond-superpower-ii-custom-simulations.html#cb679-52" aria-hidden="true" tabindex="-1"></a>    res<span class="sc">$</span>alpha[i] <span class="ot">=</span> alpha_f</span>
<span id="cb679-53"><a href="beyond-superpower-ii-custom-simulations.html#cb679-53" aria-hidden="true" tabindex="-1"></a>    res<span class="sc">$</span>success[i] <span class="ot">=</span> stop_trial</span>
<span id="cb679-54"><a href="beyond-superpower-ii-custom-simulations.html#cb679-54" aria-hidden="true" tabindex="-1"></a>    res<span class="sc">$</span>stop[i] <span class="ot">=</span> <span class="fu">ifelse</span>(stop_trial,n_f,<span class="st">&quot;fail&quot;</span>)</span>
<span id="cb679-55"><a href="beyond-superpower-ii-custom-simulations.html#cb679-55" aria-hidden="true" tabindex="-1"></a>    res<span class="sc">$</span>p.value[i] <span class="ot">=</span> sum_i[<span class="dv">4</span>]</span>
<span id="cb679-56"><a href="beyond-superpower-ii-custom-simulations.html#cb679-56" aria-hidden="true" tabindex="-1"></a>    res<span class="sc">$</span>estimate[i] <span class="ot">=</span> sum_i[<span class="dv">1</span>]</span>
<span id="cb679-57"><a href="beyond-superpower-ii-custom-simulations.html#cb679-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb679-58"><a href="beyond-superpower-ii-custom-simulations.html#cb679-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create summary of results</span></span>
<span id="cb679-59"><a href="beyond-superpower-ii-custom-simulations.html#cb679-59" aria-hidden="true" tabindex="-1"></a>  simspow <span class="ot">=</span> res <span class="sc">%&gt;%</span></span>
<span id="cb679-60"><a href="beyond-superpower-ii-custom-simulations.html#cb679-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb679-61"><a href="beyond-superpower-ii-custom-simulations.html#cb679-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">med_est =</span> <span class="fu">median</span>(estimate),</span>
<span id="cb679-62"><a href="beyond-superpower-ii-custom-simulations.html#cb679-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">power =</span> <span class="fu">mean</span>(p.value <span class="sc">&lt;</span> alpha),</span>
<span id="cb679-63"><a href="beyond-superpower-ii-custom-simulations.html#cb679-63" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate confidence intervals</span></span>
<span id="cb679-64"><a href="beyond-superpower-ii-custom-simulations.html#cb679-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">power.lci =</span> <span class="fu">prop.test</span>(<span class="fu">sum</span>(p.value <span class="sc">&lt;</span> alpha), reps)<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb679-65"><a href="beyond-superpower-ii-custom-simulations.html#cb679-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">power.uci =</span> <span class="fu">prop.test</span>(<span class="fu">sum</span>(p.value <span class="sc">&lt;</span> alpha), reps)<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb679-66"><a href="beyond-superpower-ii-custom-simulations.html#cb679-66" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb679-67"><a href="beyond-superpower-ii-custom-simulations.html#cb679-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb679-68"><a href="beyond-superpower-ii-custom-simulations.html#cb679-68" aria-hidden="true" tabindex="-1"></a>  stoppow <span class="ot">=</span> res <span class="sc">%&gt;%</span></span>
<span id="cb679-69"><a href="beyond-superpower-ii-custom-simulations.html#cb679-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(stop) <span class="sc">%&gt;%</span></span>
<span id="cb679-70"><a href="beyond-superpower-ii-custom-simulations.html#cb679-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb679-71"><a href="beyond-superpower-ii-custom-simulations.html#cb679-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop =</span> <span class="fu">n</span>()<span class="sc">/</span>reps,</span>
<span id="cb679-72"><a href="beyond-superpower-ii-custom-simulations.html#cb679-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop.lci =</span> <span class="fu">prop.test</span>(<span class="fu">n</span>(), reps)<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb679-73"><a href="beyond-superpower-ii-custom-simulations.html#cb679-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop.uci =</span> <span class="fu">prop.test</span>(<span class="fu">n</span>(), reps)<span class="sc">$</span>conf.int[<span class="dv">2</span>],</span>
<span id="cb679-74"><a href="beyond-superpower-ii-custom-simulations.html#cb679-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean.est =</span> <span class="fu">mean</span>(estimate),</span>
<span id="cb679-75"><a href="beyond-superpower-ii-custom-simulations.html#cb679-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span></span>
<span id="cb679-76"><a href="beyond-superpower-ii-custom-simulations.html#cb679-76" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb679-77"><a href="beyond-superpower-ii-custom-simulations.html#cb679-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb679-78"><a href="beyond-superpower-ii-custom-simulations.html#cb679-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb679-79"><a href="beyond-superpower-ii-custom-simulations.html#cb679-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">sims =</span> res,</span>
<span id="cb679-80"><a href="beyond-superpower-ii-custom-simulations.html#cb679-80" aria-hidden="true" tabindex="-1"></a>              <span class="at">power_tab =</span> simspow,</span>
<span id="cb679-81"><a href="beyond-superpower-ii-custom-simulations.html#cb679-81" aria-hidden="true" tabindex="-1"></a>              <span class="at">stop_tab =</span> stoppow))</span>
<span id="cb679-82"><a href="beyond-superpower-ii-custom-simulations.html#cb679-82" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, we can actually perform the simulation and with the same parameters from the last example.</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="beyond-superpower-ii-custom-simulations.html#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20210324</span>)</span>
<span id="cb680-2"><a href="beyond-superpower-ii-custom-simulations.html#cb680-2" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> <span class="fu">pwr_bidat2</span>(<span class="at">props =</span> <span class="fu">c</span>(.<span class="dv">3</span>,.<span class="dv">4</span>),</span>
<span id="cb680-3"><a href="beyond-superpower-ii-custom-simulations.html#cb680-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">N =</span> <span class="dv">1000</span>)</span>
<span id="cb680-4"><a href="beyond-superpower-ii-custom-simulations.html#cb680-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(test<span class="sc">$</span>power_tab,</span>
<span id="cb680-5"><a href="beyond-superpower-ii-custom-simulations.html#cb680-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Power for Interim Analysis Design&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-321">Table 15.3: </span>Power for Interim Analysis Design
</caption>
<thead>
<tr>
<th style="text-align:right;">
med_est
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
power.lci
</th>
<th style="text-align:right;">
power.uci
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.4617294
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
0.7614692
</td>
<td style="text-align:right;">
0.9108509
</td>
</tr>
</tbody>
</table>
<p>As we can see from the summary table above, the overall statistical power is slightly reduced (at least with 100 simulations). Below, we can plot the proportion of results that are below the corrected alpha level at 1000, 750, and 500 patients (as well as the proportion where there was a failure to find a significant result).</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="beyond-superpower-ii-custom-simulations.html#cb681-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>stop_tab <span class="sc">%&gt;%</span></span>
<span id="cb681-2"><a href="beyond-superpower-ii-custom-simulations.html#cb681-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stop =</span> <span class="fu">factor</span>(stop,</span>
<span id="cb681-3"><a href="beyond-superpower-ii-custom-simulations.html#cb681-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;fail&quot;</span>, <span class="st">&quot;500&quot;</span>,<span class="st">&quot;750&quot;</span>,<span class="st">&quot;1000&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb681-4"><a href="beyond-superpower-ii-custom-simulations.html#cb681-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> stop, <span class="at">color =</span> stop, <span class="at">y =</span> prop)) <span class="sc">+</span></span>
<span id="cb681-5"><a href="beyond-superpower-ii-custom-simulations.html#cb681-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb681-6"><a href="beyond-superpower-ii-custom-simulations.html#cb681-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> prop.lci,</span>
<span id="cb681-7"><a href="beyond-superpower-ii-custom-simulations.html#cb681-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> prop.uci)) <span class="sc">+</span> </span>
<span id="cb681-8"><a href="beyond-superpower-ii-custom-simulations.html#cb681-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="SuperpowerValidation_files/figure-html/unnamed-chunk-322-1.png" width="672" /></p>
<p>So how often can we expect the trial to end early? Well, according to this simulation we can expect the trial, under these conditions and stopping criteria, to end at N = 500 approximately 30% of the time and N = 750 about 35% of the time. So we have a very high chance of being able to save resources by using interim analyses. Note, that the confidence intervals are awfully wide from these simulations so we want to be re-run the simulation with a higher number of repetitions.</p>
<p>Another thing to point out is the effect size estimate. We can also plot the effect of treatment at every possible stopping point of the study.</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="beyond-superpower-ii-custom-simulations.html#cb682-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>stop_tab <span class="sc">%&gt;%</span></span>
<span id="cb682-2"><a href="beyond-superpower-ii-custom-simulations.html#cb682-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stop =</span> <span class="fu">factor</span>(stop,</span>
<span id="cb682-3"><a href="beyond-superpower-ii-custom-simulations.html#cb682-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;fail&quot;</span>, <span class="st">&quot;500&quot;</span>,<span class="st">&quot;750&quot;</span>,<span class="st">&quot;1000&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb682-4"><a href="beyond-superpower-ii-custom-simulations.html#cb682-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> stop, <span class="at">color =</span> stop, <span class="at">y =</span> mean.est)) <span class="sc">+</span></span>
<span id="cb682-5"><a href="beyond-superpower-ii-custom-simulations.html#cb682-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) </span></code></pre></div>
<p><img src="SuperpowerValidation_files/figure-html/unnamed-chunk-323-1.png" width="672" /></p>
<p>We can see that the effect size estimate, log-odds, are inflated when the study is stopped early (roughly double the average effect size at N=500). This is one of the disadvantages of early stopping: inflated effect size estimates. What is the reason for this peculiar pattern? In order to obtain a significant result at an early stopping point the observed effect size must be quite large. Therefore, interim analyses are selecting for very large effect sizes in order to stop the study early.</p>
</div>
</div>
<div id="conclusion-on-a-binary-rct-with-interim-analyses" class="section level2" number="15.3">
<h2><span class="header-section-number">15.3</span> Conclusion on a Binary RCT with Interim Analyses</h2>
<p>As we have documented, planning for interim analyses can be implemented with a few modifications to our existing code from the previous example. For this example we switched to a for loop to make it easier to perform the interim analyses and record the stopping point (and the relevant statistics at the stopping point). The appropriate stopping criteria (i.e., the adjusted alpha level) can be obtained from specialized R packages like <code>rpact</code>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Lakens2021" class="csl-entry">
Lakens, Daniel, Friedrich Pahlke, and Gernot Wassmer. 2021. <span>“Group Sequential Designs: A Tutorial,”</span> January. <a href="https://doi.org/10.31234/osf.io/x4azm">https://doi.org/10.31234/osf.io/x4azm</a>.
</div>
<div id="ref-Lakens2014" class="csl-entry">
Lakens, Daniël. 2014. <span>“Performing High-Powered Studies Efficiently with Sequential Analyses.”</span> <em>European Journal of Social Psychology</em> 44 (7): 701–10. <a href="https://doi.org/10.1002/ejsp.2023">https://doi.org/10.1002/ejsp.2023</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="beyond-superpower-i-mixed-models-with-simr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-1-direct-comparison-to-pwr2ppl.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SuperpowerValidation.pdf", "SuperpowerValidation.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
