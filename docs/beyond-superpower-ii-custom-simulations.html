<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 15 Beyond Superpower II: Custom Simulations | Power Analysis with Superpower</title>
  <meta name="description" content="This is a book describing the capabilities of the Superpower R package." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 15 Beyond Superpower II: Custom Simulations | Power Analysis with Superpower" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book describing the capabilities of the Superpower R package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 15 Beyond Superpower II: Custom Simulations | Power Analysis with Superpower" />
  
  <meta name="twitter:description" content="This is a book describing the capabilities of the Superpower R package." />
  

<meta name="author" content="Aaron R. Caldwell, Daniël Lakens, Chelsea M. Parlett-Pelleriti, and Guy Prochilo" />


<meta name="date" content="2021-03-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="beyond-superpower-i-mixed-models-with-simr.html"/>
<link rel="next" href="appendix-1-direct-comparison-to-pwr2ppl.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#funding"><i class="fa fa-check"></i>Funding</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html"><i class="fa fa-check"></i><b>1</b> Introduction to Power Analysis</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#overview-of-power-analysis"><i class="fa fa-check"></i><b>1.1</b> Overview of Power Analysis</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#error-and-power"><i class="fa fa-check"></i><b>1.2</b> Error and Power</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#effect-size"><i class="fa fa-check"></i><b>1.3</b> Effect size</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#samp_vs_pop"><i class="fa fa-check"></i><b>1.4</b> Sample effect size vs. population effect size</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#safeguard-effect-size"><i class="fa fa-check"></i><b>1.5</b> Safeguard Effect Size</a></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#post-hoc-power-analysis"><i class="fa fa-check"></i><b>1.6</b> <em>Post hoc</em> power analysis</a><ul>
<li class="chapter" data-level="1.6.1" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#the-sample-effect-size-is-not-the-population-effect-size"><i class="fa fa-check"></i><b>1.6.1</b> The sample effect size is <em>not</em> the population effect size</a></li>
<li class="chapter" data-level="1.6.2" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#post-hoc-power-is-merely-a-transformation-of-your-obtained-p-value"><i class="fa fa-check"></i><b>1.6.2</b> <em>Post hoc</em> power is merely a transformation of your obtained <em>p</em> value</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="introduction-to-power-analysis.html"><a href="introduction-to-power-analysis.html#the-minimal-detectable-effect-size"><i class="fa fa-check"></i><b>1.7</b> The Minimal Detectable Effect Size</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-experimental-design.html"><a href="the-experimental-design.html"><i class="fa fa-check"></i><b>2</b> The Experimental Design</a><ul>
<li class="chapter" data-level="2.1" data-path="the-experimental-design.html"><a href="the-experimental-design.html#anova_design-function"><i class="fa fa-check"></i><b>2.1</b> ANOVA_design function</a><ul>
<li class="chapter" data-level="2.1.1" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-design-using-design"><i class="fa fa-check"></i><b>2.1.1</b> Specifying the design using <code>design</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-means-using-mu"><i class="fa fa-check"></i><b>2.1.2</b> Specifying the means using <code>mu</code></a></li>
<li class="chapter" data-level="2.1.3" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-label-names"><i class="fa fa-check"></i><b>2.1.3</b> Specifying label names</a></li>
<li class="chapter" data-level="2.1.4" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-correlation"><i class="fa fa-check"></i><b>2.1.4</b> Specifying the correlation</a></li>
<li class="chapter" data-level="2.1.5" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-sample-size"><i class="fa fa-check"></i><b>2.1.5</b> Specifying the sample size</a></li>
<li class="chapter" data-level="2.1.6" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-standard-deviation"><i class="fa fa-check"></i><b>2.1.6</b> Specifying the standard deviation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="one-way-anova.html"><a href="one-way-anova.html"><i class="fa fa-check"></i><b>3</b> One-Way ANOVA</a><ul>
<li class="chapter" data-level="3.1" data-path="one-way-anova.html"><a href="one-way-anova.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="3.1.1" data-path="one-way-anova.html"><a href="one-way-anova.html#two-conditions"><i class="fa fa-check"></i><b>3.1.1</b> Two conditions</a></li>
<li class="chapter" data-level="3.1.2" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions"><i class="fa fa-check"></i><b>3.1.2</b> Three conditions</a></li>
<li class="chapter" data-level="3.1.3" data-path="one-way-anova.html"><a href="one-way-anova.html#power-for-simple-effects"><i class="fa fa-check"></i><b>3.1.3</b> Power for simple effects</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="one-way-anova.html"><a href="one-way-anova.html#effect-size-estimates-for-one-way-anova"><i class="fa fa-check"></i><b>3.2</b> Effect Size Estimates for One-Way ANOVA</a><ul>
<li class="chapter" data-level="3.2.1" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions-small-effect-size"><i class="fa fa-check"></i><b>3.2.1</b> Three conditions, small effect size</a></li>
<li class="chapter" data-level="3.2.2" data-path="one-way-anova.html"><a href="one-way-anova.html#four-conditions-medium-effect-size"><i class="fa fa-check"></i><b>3.2.2</b> Four conditions, medium effect size</a></li>
<li class="chapter" data-level="3.2.3" data-path="one-way-anova.html"><a href="one-way-anova.html#two-conditions-large-effect-size"><i class="fa fa-check"></i><b>3.2.3</b> Two conditions, large effect size</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html"><i class="fa fa-check"></i><b>4</b> Repeated Measures ANOVA</a><ul>
<li class="chapter" data-level="4.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-1"><i class="fa fa-check"></i><b>4.1</b> Part 1</a><ul>
<li class="chapter" data-level="4.1.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#two-conditions-medium-effect-size"><i class="fa fa-check"></i><b>4.1.1</b> Two conditions, medium effect size</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-2"><i class="fa fa-check"></i><b>4.2</b> Part 2</a><ul>
<li class="chapter" data-level="4.2.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#the-relation-between-cohens-f-and-cohens-d"><i class="fa fa-check"></i><b>4.2.1</b> The relation between Cohen’s f and Cohen’s d</a></li>
<li class="chapter" data-level="4.2.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#three-within-conditions-medium-effect-size"><i class="fa fa-check"></i><b>4.2.2</b> Three within conditions, medium effect size</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-3"><i class="fa fa-check"></i><b>4.3</b> Part 3</a></li>
<li class="chapter" data-level="4.4" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-4"><i class="fa fa-check"></i><b>4.4</b> Part 4</a><ul>
<li class="chapter" data-level="4.4.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#x2-anova-within-within-design"><i class="fa fa-check"></i><b>4.4.1</b> 2x2 ANOVA, within-within design</a></li>
<li class="chapter" data-level="4.4.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#examine-variation-of-means-and-correlation"><i class="fa fa-check"></i><b>4.4.2</b> Examine variation of means and correlation</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-5"><i class="fa fa-check"></i><b>4.5</b> Part 5</a><ul>
<li class="chapter" data-level="4.5.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#x2-anova-within-design"><i class="fa fa-check"></i><b>4.5.1</b> 2x2 ANOVA, within design</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#multivariate-anova-manova"><i class="fa fa-check"></i><b>4.6</b> Multivariate ANOVA (MANOVA)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mixed-anova.html"><a href="mixed-anova.html"><i class="fa fa-check"></i><b>5</b> Mixed ANOVA</a><ul>
<li class="chapter" data-level="5.1" data-path="mixed-anova.html"><a href="mixed-anova.html#simple-mixed-designs"><i class="fa fa-check"></i><b>5.1</b> Simple Mixed Designs</a></li>
<li class="chapter" data-level="5.2" data-path="mixed-anova.html"><a href="mixed-anova.html#complex-mixed-designs"><i class="fa fa-check"></i><b>5.2</b> Complex Mixed Designs</a><ul>
<li class="chapter" data-level="5.2.1" data-path="mixed-anova.html"><a href="mixed-anova.html#b3w-design"><i class="fa fa-check"></i><b>5.2.1</b> 2b*3w Design</a></li>
<li class="chapter" data-level="5.2.2" data-path="mixed-anova.html"><a href="mixed-anova.html#b4w-design"><i class="fa fa-check"></i><b>5.2.2</b> 2b*4w Design</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="power-for-three-way-interactions.html"><a href="power-for-three-way-interactions.html"><i class="fa fa-check"></i><b>6</b> Power for Three-way Interactions</a></li>
<li class="chapter" data-level="7" data-path="the-no-way-interactions.html"><a href="the-no-way-interactions.html"><i class="fa fa-check"></i><b>7</b> The ‘No-Way’ Interactions</a></li>
<li class="chapter" data-level="8" data-path="effect-of-varying-designs-on-power.html"><a href="effect-of-varying-designs-on-power.html"><i class="fa fa-check"></i><b>8</b> Effect of Varying Designs on Power</a><ul>
<li class="chapter" data-level="8.1" data-path="effect-of-varying-designs-on-power.html"><a href="effect-of-varying-designs-on-power.html#within-designs"><i class="fa fa-check"></i><b>8.1</b> Within Designs</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="error-control-in-exploratory-anova.html"><a href="error-control-in-exploratory-anova.html"><i class="fa fa-check"></i><b>9</b> Error Control in Exploratory ANOVA</a></li>
<li class="chapter" data-level="10" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html"><i class="fa fa-check"></i><b>10</b> Analytic Power Functions</a><ul>
<li class="chapter" data-level="10.1" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#one-way-between-subjects-anova"><i class="fa fa-check"></i><b>10.1</b> One-Way Between Subjects ANOVA</a></li>
<li class="chapter" data-level="10.2" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#two-way-between-subject-interaction"><i class="fa fa-check"></i><b>10.2</b> Two-way Between Subject Interaction</a></li>
<li class="chapter" data-level="10.3" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#x3-between-subject-anova"><i class="fa fa-check"></i><b>10.3</b> 3x3 Between Subject ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="power-curve.html"><a href="power-curve.html"><i class="fa fa-check"></i><b>11</b> Power Curve</a><ul>
<li class="chapter" data-level="11.1" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-effect-size-for-moderated-interactions."><i class="fa fa-check"></i><b>11.1</b> Explore increase in effect size for moderated interactions.</a></li>
<li class="chapter" data-level="11.2" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-effect-size-for-cross-over-interactions."><i class="fa fa-check"></i><b>11.2</b> Explore increase in effect size for cross-over interactions.</a></li>
<li class="chapter" data-level="11.3" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-correlation-in-moderated-interactions."><i class="fa fa-check"></i><b>11.3</b> Explore increase in correlation in moderated interactions.</a></li>
<li class="chapter" data-level="11.4" data-path="power-curve.html"><a href="power-curve.html#increasing-correlation-in-on-factor-decreases-power-in-second-factor"><i class="fa fa-check"></i><b>11.4</b> Increasing correlation in on factor decreases power in second factor</a></li>
<li class="chapter" data-level="11.5" data-path="power-curve.html"><a href="power-curve.html#code-to-reproduce-power-curve-figures"><i class="fa fa-check"></i><b>11.5</b> Code to Reproduce Power Curve Figures</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html"><i class="fa fa-check"></i><b>12</b> Violations of Assumptions</a><ul>
<li class="chapter" data-level="12.1" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html#violation-of-heterogeneity-assumption"><i class="fa fa-check"></i><b>12.1</b> Violation of Heterogeneity Assumption</a></li>
<li class="chapter" data-level="12.2" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html#violation-of-the-sphericity-assumption"><i class="fa fa-check"></i><b>12.2</b> Violation of the sphericity assumption</a><ul>
<li class="chapter" data-level="12.2.1" data-path="violations-of-assumptions.html"><a href="violations-of-assumptions.html#manova-or-sphericity-adjustment"><i class="fa fa-check"></i><b>12.2.1</b> MANOVA or Sphericity Adjustment?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html"><i class="fa fa-check"></i><b>13</b> Estimated Marginal Means</a><ul>
<li class="chapter" data-level="13.1" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#a-note-of-caution"><i class="fa fa-check"></i><b>13.1</b> A note of caution</a></li>
<li class="chapter" data-level="13.2" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#pairwise-comparisons"><i class="fa fa-check"></i><b>13.2</b> Pairwise Comparisons</a></li>
<li class="chapter" data-level="13.3" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#customized-emmeans-contrasts"><i class="fa fa-check"></i><b>13.3</b> Customized <code>emmeans</code> contrasts</a></li>
<li class="chapter" data-level="13.4" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#equivalence-and-non-superiority-inferiority-tests"><i class="fa fa-check"></i><b>13.4</b> Equivalence and non-superiority/-inferiority tests</a></li>
<li class="chapter" data-level="13.5" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#joint-tests"><i class="fa fa-check"></i><b>13.5</b> Joint tests</a></li>
<li class="chapter" data-level="13.6" data-path="estimated-marginal-means.html"><a href="estimated-marginal-means.html#monte-carlo-simulations"><i class="fa fa-check"></i><b>13.6</b> Monte Carlo Simulations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="beyond-superpower-i-mixed-models-with-simr.html"><a href="beyond-superpower-i-mixed-models-with-simr.html"><i class="fa fa-check"></i><b>14</b> Beyond Superpower I: Mixed Models with <code>simr</code></a><ul>
<li class="chapter" data-level="14.1" data-path="beyond-superpower-i-mixed-models-with-simr.html"><a href="beyond-superpower-i-mixed-models-with-simr.html#how-does-simr-work"><i class="fa fa-check"></i><b>14.1</b> How does <code>simr</code> work?</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html"><i class="fa fa-check"></i><b>15</b> Beyond Superpower II: Custom Simulations</a><ul>
<li class="chapter" data-level="15.1" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#a-clincal-trial-with-a-binary-outcome"><i class="fa fa-check"></i><b>15.1</b> A Clincal Trial with a Binary Outcome</a><ul>
<li class="chapter" data-level="15.1.1" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#proposed-study-and-approach"><i class="fa fa-check"></i><b>15.1.1</b> Proposed Study and Approach</a></li>
<li class="chapter" data-level="15.1.2" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#step-1-create-a-data-generating-function"><i class="fa fa-check"></i><b>15.1.2</b> Step 1: Create a Data Generating Function</a></li>
<li class="chapter" data-level="15.1.3" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#step-2-simulation"><i class="fa fa-check"></i><b>15.1.3</b> Step 2: Simulation</a></li>
<li class="chapter" data-level="15.1.4" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#why-more-complicated-code"><i class="fa fa-check"></i><b>15.1.4</b> Why more complicated code?</a></li>
<li class="chapter" data-level="15.1.5" data-path="beyond-superpower-ii-custom-simulations.html"><a href="beyond-superpower-ii-custom-simulations.html#conclusions-on-the-binary-rct-analysis"><i class="fa fa-check"></i><b>15.1.5</b> Conclusions on the Binary RCT Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html"><i class="fa fa-check"></i>Appendix 1: Direct Comparison to pwr2ppl</a><ul>
<li class="chapter" data-level="15.2" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#examples-from-chapter-5"><i class="fa fa-check"></i><b>15.2</b> Examples from Chapter 5</a><ul>
<li class="chapter" data-level="15.2.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-5.15.2"><i class="fa fa-check"></i><b>15.2.1</b> Example 5.1/5.2</a></li>
<li class="chapter" data-level="15.2.2" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-5.3"><i class="fa fa-check"></i><b>15.2.2</b> Example 5.3</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#examples-from-chapter-6"><i class="fa fa-check"></i><b>15.3</b> Examples from Chapter 6</a><ul>
<li class="chapter" data-level="15.3.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.2"><i class="fa fa-check"></i><b>15.3.1</b> Example from Table 6.2</a></li>
<li class="chapter" data-level="15.3.2" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.6"><i class="fa fa-check"></i><b>15.3.2</b> Example from Table 6.6</a></li>
<li class="chapter" data-level="15.3.3" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.8"><i class="fa fa-check"></i><b>15.3.3</b> Example from Table 6.8</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-chapter-7"><i class="fa fa-check"></i><b>15.4</b> Example from Chapter 7</a><ul>
<li class="chapter" data-level="15.4.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#from-table-7.2"><i class="fa fa-check"></i><b>15.4.1</b> From Table 7.2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-2-direct-comparison-to-morepower.html"><a href="appendix-2-direct-comparison-to-morepower.html"><i class="fa fa-check"></i>Appendix 2: Direct Comparison to MOREpower</a></li>
<li class="chapter" data-level="" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html"><i class="fa fa-check"></i>Appendix 3: Comparison to Brysbaert</a><ul>
<li class="chapter" data-level="15.5" data-path="one-way-anova.html"><a href="one-way-anova.html#one-way-anova"><i class="fa fa-check"></i><b>15.5</b> One-Way ANOVA</a><ul>
<li class="chapter" data-level="15.5.1" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#three-conditions-replication"><i class="fa fa-check"></i><b>15.5.1</b> Three conditions replication</a></li>
<li class="chapter" data-level="15.5.2" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#variation-1"><i class="fa fa-check"></i><b>15.5.2</b> Variation 1</a></li>
<li class="chapter" data-level="15.5.3" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#three-conditions-replication-1"><i class="fa fa-check"></i><b>15.5.3</b> Three conditions replication</a></li>
<li class="chapter" data-level="15.5.4" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#variation-2"><i class="fa fa-check"></i><b>15.5.4</b> Variation 2</a></li>
<li class="chapter" data-level="15.5.5" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#three-conditions-replication-2"><i class="fa fa-check"></i><b>15.5.5</b> Three conditions replication</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#repeated-measures"><i class="fa fa-check"></i><b>15.6</b> Repeated Measures</a><ul>
<li class="chapter" data-level="15.6.1" data-path="appendix-3-comparison-to-brysbaert.html"><a href="appendix-3-comparison-to-brysbaert.html#reproducing-brysbaert-variation-1-changing-correlation"><i class="fa fa-check"></i><b>15.6.1</b> Reproducing Brysbaert Variation 1: Changing Correlation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Power Analysis with Superpower</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="beyond-superpower-ii-custom-simulations" class="section level1">
<h1><span class="header-section-number">Chapter 15</span> Beyond Superpower II: Custom Simulations</h1>
<p>Sometimes it may be better just to simulate your planned study. If your study has peculiar features that current software does not support custom simulation may be your only possible solution. This approach is nice because it is flexible and you customize it as much as you are willing to code. The downside is that the process will be more time consuming and it is possible to introduce errors in your code.</p>
<p>In this chapter, we will provide a few vignettes on how to implement simulation-based power analyses for a variety of outcomes and designs. Overall, all you need for these simulations is an accurate data generating process and the ability to repeat that process many times (preferably a few thousand iterations).</p>
<div id="a-clincal-trial-with-a-binary-outcome" class="section level2">
<h2><span class="header-section-number">15.1</span> A Clincal Trial with a Binary Outcome</h2>
<p>This section was inspired by a Twitter <a href="https://twitter.com/ADAlthousePhD/status/1353819045829742593?s=20">thread</a> from Andrew Althouse, a PhD statistician currently at the University of Pittsburgh Medical School, on creating a simulation of Randomized Clinical/Control Trial (RCT) data. We wanted to expand on his suggestions and provide some of my own recommendations. In Andrew’s thread he explicitly used base R and only default <code>stats</code> functions that are native to R. While these are great tools, they are limited and most researchers wanting to simulate a study will find these tools lacking when trying to simulate their own particular study. This is <em>not</em> a criticism of Dr. Althouse’s thread, it is a wonderful thread. However, in this section we will use a mostly “tidy” approach for generating the data.</p>
<p>In this section we will use <code>simstudy</code> as a way to pseudo-replicate the results from Dr. Althouse. This will serve as a simple introduce to simulating experimental designs and how this can be utilized for power analysis purposes. All the code here will be “functional” which means we will define new functions that will generate the data. This way you can run multiple variations on your simulation with only a few more lines of code (rather than copy and pasting the whole simulation again and again).</p>
<p><strong>R Packages</strong></p>
<p>For this simulation I will try to restrict my use of packages to as few as possible. To simulate the data again I will need the <code>simstudy</code> package and I will also <code>tidyverse</code> set of packages to make the code “tidy”. In addition, I will need the</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="beyond-superpower-ii-custom-simulations.html#cb666-1"></a><span class="kw">library</span>(simstudy)</span>
<span id="cb666-2"><a href="beyond-superpower-ii-custom-simulations.html#cb666-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb666-3"><a href="beyond-superpower-ii-custom-simulations.html#cb666-3"></a><span class="kw">library</span>(data.table)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;data.table&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, first, last</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     transpose</code></pre>
<pre><code>## The following objects are masked from &#39;package:reshape2&#39;:
## 
##     dcast, melt</code></pre>
<div id="proposed-study-and-approach" class="section level3">
<h3><span class="header-section-number">15.1.1</span> Proposed Study and Approach</h3>
<p>According to Dr. Althouse’s documentation he was trying to simulate the following study:</p>
<ul>
<li>This code will mimic a 2-group parallel-arm randomized trial using 1:1 allocation of patients to treatment 1 versus treatment 2</li>
<li>For this example, we will use a binary outcome of “death”</li>
<li>Patients receiving treatment 1 will have a 40% probability of death</li>
<li>Patients receiving treatment 2 will have a 30% probability of death</li>
<li>Analysis will be performed using a logistic regression model</li>
<li>We will run 1000 simulated RCT’s and report the odds ratio, 95% confidence interval, and p-value for each simulated trial</li>
<li>The “true” treatment effect for a treatment that reduces probability of outcome from 40% to 30% is about OR = 0.642</li>
<li>The power of a trial with N=1000 patients and exactly 1:1 allocation under these assumptions is about 91-92%</li>
</ul>
<p>Some people reading this may already feel a tad overwhelmed. But trust me, everyone has to start somewhere and all the authors of this book were in your shoes not too long ago! Also, this is a fairly straightforward process. The process is only made easier when you use the many tools available in R. We are going to create “functions” which essentially means if I want to run the same simulation again (but maybe change 1 or 2 parameters) this can be done with only a few lines of code. This is efficient and if you are serious about writing your own simulations I would highly recommend writing your own functions for the simulation.</p>
</div>
<div id="step-1-create-a-data-generating-function" class="section level3">
<h3><span class="header-section-number">15.1.2</span> Step 1: Create a Data Generating Function</h3>
<p>This is part looks more complex than it is. All we are doing is making a function that I will call <code>gen_bidat</code> (short for “generate binomial data”). One of the things Althouse mentions in his code is that his allocation in the simulation is inappropriate. We can get around that by incorporating the functions from <code>simstudy</code> (which randomly assigns group) and keeps things organized through the <code>%&gt;%</code> (known as a “pipe”) function. We also will import the <code>data.table</code> package because the <code>simstudy</code> package generates data in a <code>data.table</code> format.</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="beyond-superpower-ii-custom-simulations.html#cb671-1"></a><span class="co"># Define function</span></span>
<span id="cb671-2"><a href="beyond-superpower-ii-custom-simulations.html#cb671-2"></a><span class="co"># Parameters</span></span>
<span id="cb671-3"><a href="beyond-superpower-ii-custom-simulations.html#cb671-3"></a><span class="co">## N = sample size</span></span>
<span id="cb671-4"><a href="beyond-superpower-ii-custom-simulations.html#cb671-4"></a><span class="co">## props = proportions in each group (length is equal to number of groups)</span></span>
<span id="cb671-5"><a href="beyond-superpower-ii-custom-simulations.html#cb671-5"></a>gen_bidat =<span class="st"> </span><span class="cf">function</span>(props,N){</span>
<span id="cb671-6"><a href="beyond-superpower-ii-custom-simulations.html#cb671-6"></a>  <span class="co"># Create data with N participants and balanced assignment to treatment group</span></span>
<span id="cb671-7"><a href="beyond-superpower-ii-custom-simulations.html#cb671-7"></a>  df =<span class="st"> </span><span class="kw">genData</span>(N) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># generate data with N participants</span></span>
<span id="cb671-8"><a href="beyond-superpower-ii-custom-simulations.html#cb671-8"></a><span class="st">    </span><span class="kw">trtAssign</span>(<span class="dt">n =</span> <span class="kw">length</span>(props),</span>
<span id="cb671-9"><a href="beyond-superpower-ii-custom-simulations.html#cb671-9"></a>              <span class="dt">balanced =</span> <span class="ot">TRUE</span>,</span>
<span id="cb671-10"><a href="beyond-superpower-ii-custom-simulations.html#cb671-10"></a>              <span class="dt">grpName =</span> <span class="st">&quot;trt&quot;</span>) <span class="co"># Randomly assign treatment (tr) in a balanced fashion  </span></span>
<span id="cb671-11"><a href="beyond-superpower-ii-custom-simulations.html#cb671-11"></a>  <span class="co"># Get the number of gropus by the number or proportions entered</span></span>
<span id="cb671-12"><a href="beyond-superpower-ii-custom-simulations.html#cb671-12"></a>  grps =<span class="st"> </span><span class="kw">length</span>(props)</span>
<span id="cb671-13"><a href="beyond-superpower-ii-custom-simulations.html#cb671-13"></a>  <span class="co"># generate condition for each group</span></span>
<span id="cb671-14"><a href="beyond-superpower-ii-custom-simulations.html#cb671-14"></a>  <span class="co"># This creates a conditional output </span></span>
<span id="cb671-15"><a href="beyond-superpower-ii-custom-simulations.html#cb671-15"></a>  <span class="co"># I.e., the odds of the outcome is determined by treatment group</span></span>
<span id="cb671-16"><a href="beyond-superpower-ii-custom-simulations.html#cb671-16"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>grps){ <span class="co"># run loop once for each group in the study</span></span>
<span id="cb671-17"><a href="beyond-superpower-ii-custom-simulations.html#cb671-17"></a>    grp =<span class="st"> </span>i<span class="dv">-1</span> <span class="co"># the simulation runs from 1 to the total number of groups</span></span>
<span id="cb671-18"><a href="beyond-superpower-ii-custom-simulations.html#cb671-18"></a>    <span class="co"># the i-1 starts the loop at zero</span></span>
<span id="cb671-19"><a href="beyond-superpower-ii-custom-simulations.html#cb671-19"></a>    <span class="co"># We then assign the group (grp) by which number in the loop we are in</span></span>
<span id="cb671-20"><a href="beyond-superpower-ii-custom-simulations.html#cb671-20"></a>    con_run =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;trt == &quot;</span>, grp)</span>
<span id="cb671-21"><a href="beyond-superpower-ii-custom-simulations.html#cb671-21"></a>    <span class="co"># We then grab the assign the correct proportion to the groups in order</span></span>
<span id="cb671-22"><a href="beyond-superpower-ii-custom-simulations.html#cb671-22"></a>    <span class="co"># We have to create the object dc first (i == 1)</span></span>
<span id="cb671-23"><a href="beyond-superpower-ii-custom-simulations.html#cb671-23"></a>    <span class="co"># All iterations of the loop add to dc rather than creating a new dc</span></span>
<span id="cb671-24"><a href="beyond-superpower-ii-custom-simulations.html#cb671-24"></a>    <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb671-25"><a href="beyond-superpower-ii-custom-simulations.html#cb671-25"></a>      dc =<span class="st"> </span><span class="kw">defCondition</span>(</span>
<span id="cb671-26"><a href="beyond-superpower-ii-custom-simulations.html#cb671-26"></a>        <span class="dt">condition =</span> con_run,</span>
<span id="cb671-27"><a href="beyond-superpower-ii-custom-simulations.html#cb671-27"></a>        <span class="dt">formula =</span> props[i],</span>
<span id="cb671-28"><a href="beyond-superpower-ii-custom-simulations.html#cb671-28"></a>        <span class="dt">dist =</span> <span class="st">&quot;binary&quot;</span>,</span>
<span id="cb671-29"><a href="beyond-superpower-ii-custom-simulations.html#cb671-29"></a>        <span class="dt">link =</span> <span class="st">&quot;identity&quot;</span></span>
<span id="cb671-30"><a href="beyond-superpower-ii-custom-simulations.html#cb671-30"></a>      )</span>
<span id="cb671-31"><a href="beyond-superpower-ii-custom-simulations.html#cb671-31"></a>    } <span class="cf">else</span>{</span>
<span id="cb671-32"><a href="beyond-superpower-ii-custom-simulations.html#cb671-32"></a>      dc =<span class="st"> </span><span class="kw">defCondition</span>(</span>
<span id="cb671-33"><a href="beyond-superpower-ii-custom-simulations.html#cb671-33"></a>        dc,</span>
<span id="cb671-34"><a href="beyond-superpower-ii-custom-simulations.html#cb671-34"></a>        <span class="dt">condition =</span> con_run,</span>
<span id="cb671-35"><a href="beyond-superpower-ii-custom-simulations.html#cb671-35"></a>        <span class="dt">formula =</span> props[i],</span>
<span id="cb671-36"><a href="beyond-superpower-ii-custom-simulations.html#cb671-36"></a>        <span class="dt">dist =</span> <span class="st">&quot;binary&quot;</span>,</span>
<span id="cb671-37"><a href="beyond-superpower-ii-custom-simulations.html#cb671-37"></a>        <span class="dt">link =</span> <span class="st">&quot;identity&quot;</span></span>
<span id="cb671-38"><a href="beyond-superpower-ii-custom-simulations.html#cb671-38"></a>      )</span>
<span id="cb671-39"><a href="beyond-superpower-ii-custom-simulations.html#cb671-39"></a>    }</span>
<span id="cb671-40"><a href="beyond-superpower-ii-custom-simulations.html#cb671-40"></a>    </span>
<span id="cb671-41"><a href="beyond-superpower-ii-custom-simulations.html#cb671-41"></a>  }</span>
<span id="cb671-42"><a href="beyond-superpower-ii-custom-simulations.html#cb671-42"></a>  <span class="co"># Now we generate the outcome based on the group (condition)</span></span>
<span id="cb671-43"><a href="beyond-superpower-ii-custom-simulations.html#cb671-43"></a>  dat &lt;-<span class="st"> </span><span class="kw">addCondition</span>(<span class="dt">condDefs =</span> dc,</span>
<span id="cb671-44"><a href="beyond-superpower-ii-custom-simulations.html#cb671-44"></a>                      <span class="dt">dtOld =</span> df,</span>
<span id="cb671-45"><a href="beyond-superpower-ii-custom-simulations.html#cb671-45"></a>                      <span class="dt">newvar =</span> <span class="st">&quot;y&quot;</span>)</span>
<span id="cb671-46"><a href="beyond-superpower-ii-custom-simulations.html#cb671-46"></a>  <span class="kw">return</span>(dat)</span>
<span id="cb671-47"><a href="beyond-superpower-ii-custom-simulations.html#cb671-47"></a>}</span>
<span id="cb671-48"><a href="beyond-superpower-ii-custom-simulations.html#cb671-48"></a></span>
<span id="cb671-49"><a href="beyond-superpower-ii-custom-simulations.html#cb671-49"></a><span class="co"># Test run</span></span>
<span id="cb671-50"><a href="beyond-superpower-ii-custom-simulations.html#cb671-50"></a><span class="kw">gen_bidat</span>(<span class="kw">c</span>(.<span class="dv">2</span>,.<span class="dv">35</span>),<span class="dt">N=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     id y trt
##  1:  1 0   0
##  2:  2 1   0
##  3:  3 0   1
##  4:  4 0   1
##  5:  5 0   1
##  6:  6 0   1
##  7:  7 0   0
##  8:  8 0   1
##  9:  9 0   0
## 10: 10 0   0</code></pre>
<p>In some cases the function above is enough. We may just want to generate a data set reflective of study we have designed. We can then “play” with the data set to plan analyses for future study. However, that is not what we are after today and we will move onto the power analysis.</p>
</div>
<div id="step-2-simulation" class="section level3">
<h3><span class="header-section-number">15.1.3</span> Step 2: Simulation</h3>
<p>Now we can get to the fun part and run a simulation. All this means is that we run the simulated data (above) for a number of iterations or repetitions (typically for thousands of iterations). We can make it a power analysis by counting the number of positive results (e.g., below the significance threshold).</p>
<p>For the power analysis we created a <code>pwr_bidat</code> function that performs a power analysis with a certain number of repetitions (<code>reps</code> argument). Notice below that we are using the function we just created (<code>gen_bidat</code>) within the <code>pwr_bidat</code> function. That is why the user must supply the same information as the last function (the proportions, <code>props</code>, and the sample size, <code>N</code>). In addition, there are two arguments needed for the power analysis: <code>alpha</code> and <code>conf.level</code>. The <code>alpha</code> argument sets the alpha-level for the analyses (i.e., the significance cutoff). While the <code>conf.level</code> argument sets the confidence level (e.g., 95%) for the confidence intervals for the power analysis. We can calculate confidence intervals for a simulation because we have a number of “successes” over a number of attempts (total number of <code>reps</code>). We can use the <code>prop.test</code> function which provides confidence intervals for proportions. This is helpful when for when we are running a small number of simulations and want an idea of what estimates of power are reasonable.</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="beyond-superpower-ii-custom-simulations.html#cb673-1"></a>pwr_bidat =<span class="st"> </span><span class="cf">function</span>(props,N,</span>
<span id="cb673-2"><a href="beyond-superpower-ii-custom-simulations.html#cb673-2"></a>                     <span class="dt">reps=</span><span class="dv">100</span>,</span>
<span id="cb673-3"><a href="beyond-superpower-ii-custom-simulations.html#cb673-3"></a>                     <span class="dt">alpha=</span>.<span class="dv">05</span>,</span>
<span id="cb673-4"><a href="beyond-superpower-ii-custom-simulations.html#cb673-4"></a>                     <span class="dt">conf.level =</span> <span class="fl">.95</span>){</span>
<span id="cb673-5"><a href="beyond-superpower-ii-custom-simulations.html#cb673-5"></a></span>
<span id="cb673-6"><a href="beyond-superpower-ii-custom-simulations.html#cb673-6"></a>  <span class="co"># Create 1 to reps simulated data sets</span></span>
<span id="cb673-7"><a href="beyond-superpower-ii-custom-simulations.html#cb673-7"></a>  sims =<span class="st"> </span><span class="kw">replicate</span>(<span class="dt">n =</span> reps,</span>
<span id="cb673-8"><a href="beyond-superpower-ii-custom-simulations.html#cb673-8"></a>                   <span class="kw">gen_bidat</span>(props, <span class="dt">N =</span> N),</span>
<span id="cb673-9"><a href="beyond-superpower-ii-custom-simulations.html#cb673-9"></a>                   <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</span>
<span id="cb673-10"><a href="beyond-superpower-ii-custom-simulations.html#cb673-10"></a>  <span class="co"># Run an equivalent number of analyses</span></span>
<span id="cb673-11"><a href="beyond-superpower-ii-custom-simulations.html#cb673-11"></a>  sims2 =<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(sims,  <span class="op">~</span><span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>trt,</span>
<span id="cb673-12"><a href="beyond-superpower-ii-custom-simulations.html#cb673-12"></a>                                  <span class="dt">data =</span> .x,</span>
<span id="cb673-13"><a href="beyond-superpower-ii-custom-simulations.html#cb673-13"></a>                                  <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>)))</span>
<span id="cb673-14"><a href="beyond-superpower-ii-custom-simulations.html#cb673-14"></a>  <span class="co"># Get the summary coefficients from our models</span></span>
<span id="cb673-15"><a href="beyond-superpower-ii-custom-simulations.html#cb673-15"></a>  sims3 =<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(sims2,  <span class="op">~</span><span class="st"> </span><span class="kw">summary</span>(.x)<span class="op">$</span>coefficients)</span>
<span id="cb673-16"><a href="beyond-superpower-ii-custom-simulations.html#cb673-16"></a>  <span class="co"># Put all the results into a data frame (tibble)</span></span>
<span id="cb673-17"><a href="beyond-superpower-ii-custom-simulations.html#cb673-17"></a>  sims4 =<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(sims3,</span>
<span id="cb673-18"><a href="beyond-superpower-ii-custom-simulations.html#cb673-18"></a>                     <span class="op">~</span><span class="st"> </span>tibble<span class="op">::</span><span class="kw">rownames_to_column</span>(<span class="kw">as.data.frame</span>(.x),</span>
<span id="cb673-19"><a href="beyond-superpower-ii-custom-simulations.html#cb673-19"></a>                                                  <span class="st">&quot;coef&quot;</span>))</span>
<span id="cb673-20"><a href="beyond-superpower-ii-custom-simulations.html#cb673-20"></a>  <span class="co"># Combine all the data frames into one</span></span>
<span id="cb673-21"><a href="beyond-superpower-ii-custom-simulations.html#cb673-21"></a>  simsdf =<span class="st"> </span><span class="kw">bind_rows</span>(sims4, <span class="dt">.id =</span> <span class="st">&quot;nrep&quot;</span>)</span>
<span id="cb673-22"><a href="beyond-superpower-ii-custom-simulations.html#cb673-22"></a>  <span class="co"># Summarize results by coefficient</span></span>
<span id="cb673-23"><a href="beyond-superpower-ii-custom-simulations.html#cb673-23"></a>  simspow =<span class="st"> </span>simsdf <span class="op">%&gt;%</span></span>
<span id="cb673-24"><a href="beyond-superpower-ii-custom-simulations.html#cb673-24"></a><span class="st">    </span><span class="kw">group_by</span>(coef) <span class="op">%&gt;%</span></span>
<span id="cb673-25"><a href="beyond-superpower-ii-custom-simulations.html#cb673-25"></a><span class="st">    </span><span class="co"># Calculate the power (number of results with p-value &lt; alpha)</span></span>
<span id="cb673-26"><a href="beyond-superpower-ii-custom-simulations.html#cb673-26"></a><span class="st">    </span><span class="kw">summarize</span>(</span>
<span id="cb673-27"><a href="beyond-superpower-ii-custom-simulations.html#cb673-27"></a>      <span class="dt">estimate =</span> <span class="kw">mean</span>(Estimate),</span>
<span id="cb673-28"><a href="beyond-superpower-ii-custom-simulations.html#cb673-28"></a>      <span class="dt">power =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">Pr(&gt;|z|)</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span>alpha),</span>
<span id="cb673-29"><a href="beyond-superpower-ii-custom-simulations.html#cb673-29"></a>      <span class="co"># Calculate confidence intervals</span></span>
<span id="cb673-30"><a href="beyond-superpower-ii-custom-simulations.html#cb673-30"></a>      <span class="dt">power.lci =</span> <span class="kw">prop.test</span>(<span class="kw">sum</span>(<span class="st">`</span><span class="dt">Pr(&gt;|z|)</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span>alpha), reps)<span class="op">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb673-31"><a href="beyond-superpower-ii-custom-simulations.html#cb673-31"></a>      <span class="dt">power.uci =</span> <span class="kw">prop.test</span>(<span class="kw">sum</span>(<span class="st">`</span><span class="dt">Pr(&gt;|z|)</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span>alpha), reps)<span class="op">$</span>conf.int[<span class="dv">2</span>],</span>
<span id="cb673-32"><a href="beyond-superpower-ii-custom-simulations.html#cb673-32"></a>      <span class="dt">.groups =</span> <span class="st">&#39;drop&#39;</span></span>
<span id="cb673-33"><a href="beyond-superpower-ii-custom-simulations.html#cb673-33"></a>    )</span>
<span id="cb673-34"><a href="beyond-superpower-ii-custom-simulations.html#cb673-34"></a>  </span>
<span id="cb673-35"><a href="beyond-superpower-ii-custom-simulations.html#cb673-35"></a>  <span class="co"># Return table of results</span></span>
<span id="cb673-36"><a href="beyond-superpower-ii-custom-simulations.html#cb673-36"></a>  <span class="kw">return</span>(simspow)</span>
<span id="cb673-37"><a href="beyond-superpower-ii-custom-simulations.html#cb673-37"></a>}</span>
<span id="cb673-38"><a href="beyond-superpower-ii-custom-simulations.html#cb673-38"></a></span>
<span id="cb673-39"><a href="beyond-superpower-ii-custom-simulations.html#cb673-39"></a><span class="kw">set.seed</span>(<span class="dv">01292020</span>)</span>
<span id="cb673-40"><a href="beyond-superpower-ii-custom-simulations.html#cb673-40"></a>pwr_res =<span class="st"> </span><span class="kw">pwr_bidat</span>(<span class="kw">c</span>(.<span class="dv">4</span>,.<span class="dv">3</span>),<span class="dt">N=</span><span class="dv">1000</span>)</span></code></pre></div>
<p>Now that we have the results we can create a table as output using the <code>kable</code> function.</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="beyond-superpower-ii-custom-simulations.html#cb674-1"></a><span class="co"># Create pretty table to print results</span></span>
<span id="cb674-2"><a href="beyond-superpower-ii-custom-simulations.html#cb674-2"></a>knitr<span class="op">::</span><span class="kw">kable</span>(pwr_res <span class="op">%&gt;%</span></span>
<span id="cb674-3"><a href="beyond-superpower-ii-custom-simulations.html#cb674-3"></a><span class="st">               </span><span class="kw">rename</span>(<span class="dt">Coefficients =</span> coef,</span>
<span id="cb674-4"><a href="beyond-superpower-ii-custom-simulations.html#cb674-4"></a>                      <span class="st">`</span><span class="dt">Average Log Odds</span><span class="st">`</span> =<span class="st"> </span>estimate,</span>
<span id="cb674-5"><a href="beyond-superpower-ii-custom-simulations.html#cb674-5"></a>                      <span class="dt">Power =</span> power,</span>
<span id="cb674-6"><a href="beyond-superpower-ii-custom-simulations.html#cb674-6"></a>                      <span class="st">`</span><span class="dt">Lower C.I.</span><span class="st">`</span> =<span class="st"> </span>power.lci,</span>
<span id="cb674-7"><a href="beyond-superpower-ii-custom-simulations.html#cb674-7"></a>                      <span class="st">`</span><span class="dt">Upper C.I.</span><span class="st">`</span> =<span class="st"> </span>power.uci),</span>
<span id="cb674-8"><a href="beyond-superpower-ii-custom-simulations.html#cb674-8"></a>             <span class="dt">digits =</span> <span class="dv">2</span>,</span>
<span id="cb674-9"><a href="beyond-superpower-ii-custom-simulations.html#cb674-9"></a>             <span class="dt">caption =</span> <span class="st">&quot;Result from Power Simulation&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-313">Table 15.1: </span>Result from Power Simulation
</caption>
<thead>
<tr>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Average Log Odds
</th>
<th style="text-align:right;">
Power
</th>
<th style="text-align:right;">
Lower C.I.
</th>
<th style="text-align:right;">
Upper C.I.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-0.43
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
trt
</td>
<td style="text-align:right;">
-0.43
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0.95
</td>
</tr>
</tbody>
</table>
<p>Based on these results we can can conclude that a study of 1000 patients randomly assigned to one of two treatment groups wherein 30% of participants die in treatment group #1 and 40% perish in treatment group #2 will have approximately 95% power [0.82,0.95]. Notice, that compared to Dr. Althouse’s thread, we estimated the power at 95% (thread noted power at ~92.3%). This is to be expected when simulating data and is why a high number of repetitions are needed to get an accurate estimate of power.</p>
</div>
<div id="why-more-complicated-code" class="section level3">
<h3><span class="header-section-number">15.1.4</span> Why more complicated code?</h3>
<p>Well, here is why we create functions: it is easier on yourself in the future. Say, we run three separate simulations with minor differences so I go about with the Althouse approach (maybe even copy and paste the code a few times). Later, I notice a flaw in my code, or maybe there is a small change that alters all three simulations. Well, if I take the time to create the customized functions then all I have to do is change the code in one place (where I defined the function) rather than with every chunk of code that includes the simulation code.</p>
<p>Also, it is easier to produce variations on the same design. Let’s imagine we are doing a study on a treatment for an infectious disease that has a hospitalization rate of at least 3.5% people that get infected (so treatment occurs immediately upon diagnosis and only the most severe are hospitalized). The study investigators want to know if 2000 patients are enough to detect if the proposed treatment reduces the hospitalization rate at least by half (1.75%).</p>
<p>All I have to do is use the same function I have created above but change the arguments in the function.</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="beyond-superpower-ii-custom-simulations.html#cb675-1"></a>pwr_<span class="dv">2</span> =<span class="st"> </span><span class="kw">pwr_bidat</span>(<span class="kw">c</span>(.<span class="dv">035</span>,.<span class="dv">0175</span>),<span class="dt">N=</span><span class="dv">2000</span>)</span>
<span id="cb675-2"><a href="beyond-superpower-ii-custom-simulations.html#cb675-2"></a></span>
<span id="cb675-3"><a href="beyond-superpower-ii-custom-simulations.html#cb675-3"></a>knitr<span class="op">::</span><span class="kw">kable</span>(pwr_<span class="dv">2</span>,</span>
<span id="cb675-4"><a href="beyond-superpower-ii-custom-simulations.html#cb675-4"></a>             <span class="dt">caption =</span> <span class="st">&quot;Another Study of Binary Outcomes&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-314">Table 15.2: </span>Another Study of Binary Outcomes
</caption>
<thead>
<tr>
<th style="text-align:left;">
coef
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
power.lci
</th>
<th style="text-align:right;">
power.uci
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-3.3449342
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.9538987
</td>
<td style="text-align:right;">
1.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
trt
</td>
<td style="text-align:right;">
-0.6826144
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
0.5782080
</td>
<td style="text-align:right;">
0.7677615
</td>
</tr>
</tbody>
</table>
<p>Now, we have the new results in only 4 lines of code! Based on those results we would likely advise the investigators that they will need a larger sample size to conclude effectiveness for their proposed treatment.</p>
</div>
<div id="conclusions-on-the-binary-rct-analysis" class="section level3">
<h3><span class="header-section-number">15.1.5</span> Conclusions on the Binary RCT Analysis</h3>
<p>In this section we have demonstrated how to create 2 R functions that 1) generate data and 2) generate a simulation based power analysis. Simulation is not necessary for a simple analysis such as this where analytic solutions exist in programs like <code>GPower</code> or <code>Superpower</code>. However, as we will detail in the next sections, simulation becomes <em>very</em> useful when the design becomes complicated (or when we want to violate the assumptions of the models we use).</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="beyond-superpower-i-mixed-models-with-simr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-1-direct-comparison-to-pwr2ppl.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SuperpowerValidation.pdf", "SuperpowerValidation.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
